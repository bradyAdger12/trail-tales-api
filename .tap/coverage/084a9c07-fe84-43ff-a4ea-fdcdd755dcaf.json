{
  "result": [
    {
      "scriptId": "644",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/server.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 11106,
              "count": 1
            },
            {
              "startOffset": 407,
              "endOffset": 488,
              "count": 0
            },
            {
              "startOffset": 664,
              "endOffset": 706,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 88,
              "endOffset": 405,
              "count": 24
            },
            {
              "startOffset": 232,
              "endOffset": 247,
              "count": 0
            },
            {
              "startOffset": 264,
              "endOffset": 284,
              "count": 16
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "get",
          "ranges": [
            {
              "startOffset": 327,
              "endOffset": 354,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 410,
              "endOffset": 487,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 571,
              "endOffset": 662,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__setModuleDefault",
          "ranges": [
            {
              "startOffset": 666,
              "endOffset": 706,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 760,
              "endOffset": 1368,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "ownKeys",
          "ranges": [
            {
              "startOffset": 792,
              "endOffset": 1056,
              "count": 1
            },
            {
              "startOffset": 851,
              "endOffset": 1022,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "ownKeys",
          "ranges": [
            {
              "startOffset": 854,
              "endOffset": 1022,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "__importStar",
          "ranges": [
            {
              "startOffset": 1069,
              "endOffset": 1365,
              "count": 8
            },
            {
              "startOffset": 1121,
              "endOffset": 1132,
              "count": 0
            },
            {
              "startOffset": 1236,
              "endOffset": 1295,
              "count": 32
            },
            {
              "startOffset": 1260,
              "endOffset": 1295,
              "count": 24
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 1429,
              "endOffset": 1510,
              "count": 9
            },
            {
              "startOffset": 1481,
              "endOffset": 1486,
              "count": 8
            },
            {
              "startOffset": 1487,
              "endOffset": 1507,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "buildServer",
          "ranges": [
            {
              "startOffset": 2339,
              "endOffset": 4626,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 3758,
              "endOffset": 3808,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 4542,
              "endOffset": 4602,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "904",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 31880,
              "count": 1
            },
            {
              "startOffset": 407,
              "endOffset": 488,
              "count": 0
            },
            {
              "startOffset": 664,
              "endOffset": 706,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 88,
              "endOffset": 405,
              "count": 71
            },
            {
              "startOffset": 232,
              "endOffset": 247,
              "count": 7
            },
            {
              "startOffset": 248,
              "endOffset": 284,
              "count": 64
            },
            {
              "startOffset": 264,
              "endOffset": 284,
              "count": 1
            },
            {
              "startOffset": 287,
              "endOffset": 363,
              "count": 70
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "get",
          "ranges": [
            {
              "startOffset": 327,
              "endOffset": 354,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 410,
              "endOffset": 487,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 571,
              "endOffset": 662,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__setModuleDefault",
          "ranges": [
            {
              "startOffset": 666,
              "endOffset": 706,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 760,
              "endOffset": 1368,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "ownKeys",
          "ranges": [
            {
              "startOffset": 792,
              "endOffset": 1056,
              "count": 1
            },
            {
              "startOffset": 851,
              "endOffset": 1022,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "ownKeys",
          "ranges": [
            {
              "startOffset": 854,
              "endOffset": 1022,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "__importStar",
          "ranges": [
            {
              "startOffset": 1069,
              "endOffset": 1365,
              "count": 1
            },
            {
              "startOffset": 1121,
              "endOffset": 1132,
              "count": 0
            },
            {
              "startOffset": 1236,
              "endOffset": 1295,
              "count": 71
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 1429,
              "endOffset": 1510,
              "count": 2
            },
            {
              "startOffset": 1481,
              "endOffset": 1486,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "authRoutes",
          "ranges": [
            {
              "startOffset": 2032,
              "endOffset": 9976,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 2718,
              "endOffset": 3857,
              "count": 4
            },
            {
              "startOffset": 2935,
              "endOffset": 3049,
              "count": 1
            },
            {
              "startOffset": 3049,
              "endOffset": 3460,
              "count": 3
            },
            {
              "startOffset": 3460,
              "endOffset": 3558,
              "count": 1
            },
            {
              "startOffset": 3558,
              "endOffset": 3856,
              "count": 2
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 4404,
              "endOffset": 5339,
              "count": 2
            },
            {
              "startOffset": 4740,
              "endOffset": 4975,
              "count": 1
            },
            {
              "startOffset": 4975,
              "endOffset": 5079,
              "count": 0
            },
            {
              "startOffset": 5079,
              "endOffset": 5338,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 5575,
              "endOffset": 6579,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 7022,
              "endOffset": 8322,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 8815,
              "endOffset": 9972,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "993",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/lib/safe_return_data.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 1113,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "994",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/resend/send_email.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 5612,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 3
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 1
            },
            {
              "startOffset": 128,
              "endOffset": 148,
              "count": 2
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "sendEmail",
          "ranges": [
            {
              "startOffset": 517,
              "endOffset": 1699,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1050",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.schema.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 2436,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "1051",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.schema.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 4560,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "1052",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.schema.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 2003,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "1053",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.schema.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 5097,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "1054",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/db.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 916,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "1061",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.controller.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 2470,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "signAccessToken",
          "ranges": [
            {
              "startOffset": 369,
              "endOffset": 550,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "signRefreshToken",
          "ranges": [
            {
              "startOffset": 551,
              "endOffset": 741,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "1062",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 10937,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "userRoutes",
          "ranges": [
            {
              "startOffset": 439,
              "endOffset": 3169,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 1123,
              "endOffset": 2361,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 2681,
              "endOffset": 3165,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1063",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authentication.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 3453,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "authenticate",
          "ranges": [
            {
              "startOffset": 333,
              "endOffset": 970,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1065",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 53876,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "squadRoutes",
          "ranges": [
            {
              "startOffset": 616,
              "endOffset": 15723,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 1343,
              "endOffset": 3188,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 3831,
              "endOffset": 5226,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 5706,
              "endOffset": 7201,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 7942,
              "endOffset": 8906,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 9634,
              "endOffset": 10782,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 11319,
              "endOffset": 12057,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 12607,
              "endOffset": 13314,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 13993,
              "endOffset": 15719,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1066",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_squad.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 2587,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "squadAuthorization",
          "ranges": [
            {
              "startOffset": 172,
              "endOffset": 640,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1067",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/member/member.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 5858,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "memberRoutes",
          "ranges": [
            {
              "startOffset": 272,
              "endOffset": 1608,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 909,
              "endOffset": 1604,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1068",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 32947,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "activityRoutes",
          "ranges": [
            {
              "startOffset": 400,
              "endOffset": 9651,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 1456,
              "endOffset": 4117,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 4857,
              "endOffset": 5537,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 6089,
              "endOffset": 6551,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 6897,
              "endOffset": 7310,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 7850,
              "endOffset": 8580,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 8946,
              "endOffset": 9647,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1069",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.schema.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 3936,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        }
      ]
    },
    {
      "scriptId": "1070",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_activity.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 3142,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "activityAuthorization",
          "ranges": [
            {
              "startOffset": 370,
              "endOffset": 921,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1071",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.controller.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 10464,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "processActivityForMatchup",
          "ranges": [
            {
              "startOffset": 366,
              "endOffset": 688,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "processFastestSegment",
          "ranges": [
            {
              "startOffset": 689,
              "endOffset": 2317,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "findFastestSegment",
          "ranges": [
            {
              "startOffset": 2318,
              "endOffset": 3011,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1072",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 52403,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "matchupRoutes",
          "ranges": [
            {
              "startOffset": 507,
              "endOffset": 16796,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 1013,
              "endOffset": 6558,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 7239,
              "endOffset": 8548,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 9220,
              "endOffset": 11789,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 12443,
              "endOffset": 16792,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1073",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/cron/post_matchup.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 20813,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "getSquadLevel",
          "ranges": [
            {
              "startOffset": 407,
              "endOffset": 617,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "calculateWinningSquadByTime",
          "ranges": [
            {
              "startOffset": 618,
              "endOffset": 1088,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "getTimesAndSum",
          "ranges": [
            {
              "startOffset": 1089,
              "endOffset": 1649,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "determineWinningAndLosingSquad",
          "ranges": [
            {
              "startOffset": 1650,
              "endOffset": 1863,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        },
        {
          "functionName": "buildPostMatchupReports",
          "ranges": [
            {
              "startOffset": 2193,
              "endOffset": 6264,
              "count": 1
            },
            {
              "startOffset": 4456,
              "endOffset": 6208,
              "count": 0
            },
            {
              "startOffset": 6219,
              "endOffset": 6262,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 6142,
              "endOffset": 6196,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1080",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/strava/strava.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 2090,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "__importDefault",
          "ranges": [
            {
              "startOffset": 70,
              "endOffset": 151,
              "count": 1
            },
            {
              "startOffset": 122,
              "endOffset": 127,
              "count": 0
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "stravaRoutes",
          "ranges": [
            {
              "startOffset": 313,
              "endOffset": 564,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 362,
              "endOffset": 560,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    },
    {
      "scriptId": "1081",
      "url": "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.routes.ts",
      "functions": [
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 0,
              "endOffset": 2632,
              "count": 1
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "challengeRoutes",
          "ranges": [
            {
              "startOffset": 262,
              "endOffset": 659,
              "count": 8
            }
          ],
          "isBlockCoverage": true
        },
        {
          "functionName": "",
          "ranges": [
            {
              "startOffset": 528,
              "endOffset": 655,
              "count": 0
            }
          ],
          "isBlockCoverage": false
        }
      ]
    }
  ],
  "timestamp": 1014533.679925,
  "source-map-cache": {
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/server.ts": {
      "lineLengths": [
        13,
        97,
        33,
        53,
        88,
        68,
        5,
        39,
        29,
        33,
        17,
        4,
        96,
        72,
        21,
        21,
        3,
        64,
        31,
        62,
        24,
        95,
        22,
        10,
        26,
        6,
        27,
        46,
        24,
        137,
        40,
        22,
        6,
        5,
        72,
        62,
        2,
        62,
        54,
        25,
        76,
        76,
        79,
        82,
        88,
        85,
        82,
        91,
        15,
        24,
        20,
        44,
        21,
        7,
        51,
        18,
        29,
        19,
        35,
        65,
        32,
        14,
        22,
        17,
        49,
        53,
        17,
        14,
        19,
        89,
        73,
        75,
        77,
        79,
        80,
        14,
        25,
        34,
        33,
        37,
        41,
        43,
        21,
        17,
        13,
        9,
        7,
        98,
        29,
        19,
        33,
        30,
        9,
        7,
        26,
        44,
        65,
        67,
        69,
        73,
        71,
        69,
        76,
        48,
        32,
        7,
        19,
        1,
        30,
        6448
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/server.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/server.ts"
        ],
        "names": [],
        "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,sDAA8B;AAC9B,yBAAsB;AAEtB,4EAAmD;AACnD,4EAAmD;AACnD,+EAAsD;AACtD,kFAAyD;AACzD,wFAA+D;AAC/D,qFAA4D;AAC5D,kFAAyD;AACzD,2FAAkE;AAElE,eAAe;AACf,SAAS,WAAW;IAElB,gBAAgB;IAChB,MAAM,OAAO,GAAG,IAAA,iBAAO,EAAC;QACtB,MAAM,EAAE,KAAK;KACd,CAAC,CAAC;IAEH,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE;QAC5C,OAAO,EAAE;YACP,OAAO,EAAE,OAAO;YAChB,IAAI,EAAE;gBACJ,KAAK,EAAE,WAAW;gBAClB,WAAW,EAAE,mCAAmC;gBAChD,OAAO,EAAE,OAAO;aACjB;YACD,OAAO,EAAE;gBACP;oBACE,GAAG,EAAE,uBAAuB;oBAC5B,WAAW,EAAE,oBAAoB;iBAClC;aACF;YACD,IAAI,EAAE;gBACJ,EAAE,IAAI,EAAE,MAAM,EAAE,WAAW,EAAE,yCAAyC,EAAE;gBACxE,EAAE,IAAI,EAAE,MAAM,EAAE,WAAW,EAAE,yBAAyB,EAAE;gBACxD,EAAE,IAAI,EAAE,OAAO,EAAE,WAAW,EAAE,0BAA0B,EAAE;gBAC1D,EAAE,IAAI,EAAE,QAAQ,EAAE,WAAW,EAAE,2BAA2B,EAAE;gBAC5D,EAAE,IAAI,EAAE,SAAS,EAAE,WAAW,EAAE,4BAA4B,EAAE;gBAC9D,EAAE,IAAI,EAAE,UAAU,EAAE,WAAW,EAAE,6BAA6B,EAAE;aACjE;YACD,UAAU,EAAE;gBACV,eAAe,EAAE;oBACf,UAAU,EAAE;wBACV,IAAI,EAAE,MAAM;wBACZ,MAAM,EAAE,QAAQ;wBAChB,YAAY,EAAE,KAAK;qBACpB;iBACF;aACF;SACF;KACF,CAAC,CAAA;IAEF,OAAO,CAAC,QAAQ,mDAAQ,qBAAqB,KAAG;QAC9C,WAAW,EAAE,OAAO;QACpB,QAAQ,EAAE;YACR,YAAY,EAAE,MAAM;YACpB,WAAW,EAAE,KAAK;SACnB;KACF,CAAC,CAAA;IAGF,sBAAsB;IACtB,OAAO,CAAC,QAAQ,CAAC,qBAAU,CAAC,CAAC;IAC7B,OAAO,CAAC,QAAQ,CAAC,qBAAU,EAAE,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAA;IACjD,OAAO,CAAC,QAAQ,CAAC,sBAAW,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAA;IACnD,OAAO,CAAC,QAAQ,CAAC,uBAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAA;IACrD,OAAO,CAAC,QAAQ,CAAC,yBAAc,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC,CAAA;IACzD,OAAO,CAAC,QAAQ,CAAC,wBAAa,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAAA;IACvD,OAAO,CAAC,QAAQ,CAAC,uBAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAA;IACrD,OAAO,CAAC,QAAQ,CAAC,0BAAe,EAAE,EAAE,MAAM,EAAE,aAAa,EAAE,CAAC,CAAA;IAE5D,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE;QACxC,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,CAAA;IACzB,CAAC,CAAC,CAAA;IAEF,OAAO,OAAO,CAAA;AAChB,CAAC;AAED,kBAAe,WAAW,CAAA",
        "sourcesContent": [
          "import Fastify from \"fastify\";\r\nimport 'dotenv/config'\r\nimport _ from 'lodash'\r\nimport authRoutes from \"./routes/auth/auth.routes\";\r\nimport userRoutes from \"./routes/user/user.routes\";\r\nimport squadRoutes from \"./routes/squad/squad.routes\";\r\nimport memberRoutes from \"./routes/member/member.routes\";\r\nimport activityRoutes from \"./routes/activity/activity.routes\";\r\nimport matchupRoutes from \"./routes/matchup/matchup.routes\";\r\nimport stravaRoutes from \"./routes/strava/strava.routes\";\r\nimport challengeRoutes from \"./routes/challenge/challenge.routes\";\r\n\r\n// Build Server\r\nfunction buildServer() {\r\n\r\n  // Define server\r\n  const fastify = Fastify({\r\n    logger: false\r\n  });\r\n\r\n  fastify.register(require('@fastify/swagger'), {\r\n    openapi: {\r\n      openapi: '3.0.0',\r\n      info: {\r\n        title: 'Run Squad',\r\n        description: 'Testing the Run Squad swagger API',\r\n        version: '0.1.0'\r\n      },\r\n      servers: [\r\n        {\r\n          url: 'http://localhost:8080',\r\n          description: 'Development server'\r\n        }\r\n      ],\r\n      tags: [\r\n        { name: 'auth', description: 'Unauthenticated User related end-points' },\r\n        { name: 'user', description: 'User related end-points' },\r\n        { name: 'squad', description: 'Squad related end-points' },\r\n        { name: 'member', description: 'Member related end-points' },\r\n        { name: 'matchup', description: 'Matchup related end-points' },\r\n        { name: 'activity', description: 'Activity related end-points' }\r\n      ],\r\n      components: {\r\n        securitySchemes: {\r\n          bearerAuth: {\r\n            type: 'http',\r\n            scheme: 'bearer',\r\n            bearerFormat: 'JWT'\r\n          }\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  fastify.register(import('@fastify/swagger-ui'), {\r\n    routePrefix: '/docs',\r\n    uiConfig: {\r\n      docExpansion: 'full',\r\n      deepLinking: false\r\n    }\r\n  })\r\n\r\n\r\n  // Register components\r\n  fastify.register(authRoutes);\r\n  fastify.register(userRoutes, { prefix: '/user' })\r\n  fastify.register(squadRoutes, { prefix: '/squad' })\r\n  fastify.register(memberRoutes, { prefix: '/member' })\r\n  fastify.register(activityRoutes, { prefix: '/activity' })\r\n  fastify.register(matchupRoutes, { prefix: '/matchup' })\r\n  fastify.register(stravaRoutes, { prefix: '/strava' })\r\n  fastify.register(challengeRoutes, { prefix: '/challenges' })\r\n\r\n  fastify.get('/health', (request, reply) => {\r\n    return { status: 'ok' }\r\n  })\r\n\r\n  return fastify\r\n}\r\n\r\nexport default buildServer"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.routes.ts": {
      "lineLengths": [
        13,
        97,
        33,
        53,
        88,
        68,
        5,
        39,
        29,
        33,
        17,
        4,
        96,
        72,
        21,
        21,
        3,
        64,
        31,
        62,
        24,
        95,
        22,
        10,
        26,
        6,
        27,
        46,
        24,
        137,
        40,
        22,
        6,
        5,
        72,
        62,
        2,
        62,
        52,
        64,
        65,
        52,
        56,
        53,
        33,
        55,
        39,
        15,
        31,
        17,
        27,
        19,
        31,
        29,
        46,
        49,
        52,
        18,
        63,
        14,
        23,
        22,
        35,
        33,
        52,
        21,
        17,
        13,
        9,
        34,
        34,
        33,
        39,
        46,
        34,
        102,
        9,
        56,
        65,
        71,
        56,
        20,
        24,
        33,
        17,
        13,
        11,
        35,
        86,
        9,
        39,
        56,
        19,
        34,
        38,
        41,
        13,
        11,
        33,
        7,
        12,
        28,
        17,
        27,
        19,
        31,
        29,
        46,
        48,
        18,
        47,
        14,
        23,
        140,
        13,
        9,
        34,
        34,
        33,
        39,
        55,
        20,
        24,
        33,
        17,
        13,
        11,
        20,
        92,
        9,
        97,
        33,
        92,
        9,
        65,
        73,
        39,
        18,
        25,
        16,
        11,
        7,
        30,
        17,
        27,
        23,
        100,
        13,
        9,
        34,
        60,
        26,
        102,
        9,
        13,
        107,
        102,
        31,
        42,
        75,
        83,
        47,
        13,
        18,
        71,
        13,
        9,
        19,
        102,
        9,
        7,
        27,
        42,
        17,
        27,
        19,
        31,
        29,
        45,
        18,
        35,
        14,
        23,
        69,
        13,
        9,
        34,
        34,
        33,
        61,
        56,
        70,
        39,
        108,
        40,
        55,
        20,
        24,
        33,
        17,
        13,
        11,
        19,
        17,
        61,
        27,
        41,
        44,
        35,
        21,
        19,
        178,
        13,
        23,
        69,
        13,
        9,
        33,
        7,
        21,
        36,
        17,
        27,
        19,
        31,
        29,
        46,
        48,
        18,
        47,
        14,
        23,
        69,
        13,
        9,
        34,
        34,
        39,
        34,
        102,
        9,
        33,
        85,
        20,
        24,
        33,
        17,
        13,
        11,
        36,
        82,
        9,
        60,
        63,
        9,
        56,
        76,
        60,
        19,
        31,
        14,
        20,
        48,
        13,
        11,
        33,
        7,
        2,
        29,
        21872
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.routes.ts"
        ],
        "names": [],
        "mappings": "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",
        "sourcesContent": [
          "import { FastifyPluginAsync } from 'fastify';\r\nimport _ from 'lodash'\r\nimport bcrypt from 'bcrypt'\r\nimport jwt from 'jsonwebtoken'\r\nimport { SAFE_USER_RETURN } from '../../lib/safe_return_data';\r\nimport * as crypto from \"node:crypto\";\r\nimport { sendEmail } from '../../resend/send_email';\r\nimport { SCHEMA_USER_RETURN } from '../user/user.schema';\r\nimport { prisma } from '../../db';\r\nimport { User } from '@prisma/client';\r\nimport { signAccessToken, signRefreshToken } from './auth.controller';\r\n\r\nconst authRoutes: FastifyPluginAsync = async (fastify) => {\r\n\r\n    // Register\r\n    fastify.post('/register', {\r\n        schema: {\r\n            tags: ['auth'],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    email: { type: 'string' },\r\n                    password: { type: 'string' },\r\n                    display_name: { type: 'string' }\r\n                },\r\n                required: ['email', 'password', 'display_name']\r\n            },\r\n            response: {\r\n                201: {\r\n                    type: 'object',\r\n                    properties: {\r\n                        success: { type: 'boolean' }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const body = request.body as { email: string, password: string, display_name: string }\r\n        const email = body.email\r\n        const password = body.password as string\r\n        const displayName = body.display_name as string\r\n\r\n        if (password.length < 8) {\r\n            return reply.status(400).send({ message: 'Password must be at least 8 characters long' })\r\n        }\r\n        const salt = await bcrypt.genSalt(10);\r\n        const hash = await bcrypt.hash(password, salt);\r\n        const user_with_same_email = await prisma.user.findFirst({\r\n            select: SAFE_USER_RETURN,\r\n            where: {\r\n                email: {\r\n                    equals: email\r\n                }\r\n            }\r\n        })\r\n        if (user_with_same_email) {\r\n            return reply.status(500).send({ message: 'User with same email exists' })\r\n        }\r\n        await prisma.user.create({\r\n            select: SAFE_USER_RETURN,\r\n            data: {\r\n                email: body.email,\r\n                hashed_password: hash,\r\n                display_name: displayName\r\n            }\r\n        })\r\n        return { success: true }\r\n    });\r\n\r\n    // Login\r\n    fastify.post('/login', {\r\n        schema: {\r\n            tags: ['auth'],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    email: { type: 'string' },\r\n                    password: { type: 'string' }\r\n                },\r\n                required: ['email', 'password']\r\n            },\r\n            response: {\r\n                200: { properties: { token: { type: 'string' }, refreshToken: { type: 'string' }, user: SCHEMA_USER_RETURN } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const body = request.body as { email: string, password: string }\r\n        const email = body.email\r\n        const password = body.password as string\r\n        const user = await prisma.user.findFirst({\r\n            where: {\r\n                email: {\r\n                    equals: email\r\n                }\r\n            }\r\n        })\r\n        if (!user) {\r\n            return reply.status(401).send({ message: 'Username or password is incorrect' })\r\n        }\r\n        const isCorrectPassword = await bcrypt.compare(password, user.hashed_password)\r\n        if (!isCorrectPassword) {\r\n            return reply.status(401).send({ message: 'Username or password is incorrect' })\r\n        }\r\n\r\n        var token = signAccessToken(user)\r\n        var refreshToken = signRefreshToken(user)\r\n        return reply.status(200).send({\r\n            token,\r\n            refreshToken,\r\n            user\r\n        })\r\n    });\r\n\r\n    fastify.post('/refresh', {\r\n        schema: {\r\n            tags: ['auth'],\r\n            response: {\r\n                200: { properties: { token: { type: 'string' }, refreshToken: { type: 'string' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const authHeader = request.headers['authorization']\r\n        if (!authHeader) {\r\n            return reply.status(403).send('You do have not have permissions to access this resource')\r\n        }\r\n        try {\r\n            const token: string = authHeader?.split(' ')[1]!\r\n            const decodedToken = jwt.verify(token, process.env.JWT_REFRESH_SECRET as string)\r\n            if (decodedToken) {\r\n                const user = decodedToken as User\r\n                const token = signAccessToken(user)\r\n                const refreshToken = signRefreshToken(user)\r\n                return { token, refreshToken }\r\n            } else {\r\n                return reply.status(401).send('Invalid refresh token')\r\n            }\r\n        } catch (e) {\r\n            return reply.status(401).send('You do have not have permissions to access this resource')\r\n        }\r\n    });\r\n\r\n    // Password Reset Email\r\n    fastify.post('/send_password_reset', {\r\n        schema: {\r\n            tags: ['auth'],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    email: { type: 'string' }\r\n                },\r\n                required: ['email']\r\n            },\r\n            response: {\r\n                200: { properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const body = request.body as { email: string }\r\n        const email = body.email\r\n        const token = crypto.randomBytes(64).toString('hex');\r\n        const salt = await bcrypt.genSalt(10)\r\n        const hashed_token = await bcrypt.hash(token, salt)\r\n        const expiry_date = new Date()\r\n        expiry_date.setDate(expiry_date.getDate() + 1) // set 24 hour expiry time for password reset tokens\r\n        const expiry_time = expiry_date\r\n        const user = await prisma.user.findFirst({\r\n            where: {\r\n                email: {\r\n                    equals: email\r\n                }\r\n            }\r\n        })\r\n        if (user) {\r\n            try {\r\n                await prisma.passwordResetToken.create({\r\n                    data: {\r\n                        user_id: user.id,\r\n                        token: hashed_token,\r\n                        expiry_time\r\n                    }\r\n                })\r\n                await sendEmail('password_reset.html', { url: `${process.env.WEB_BASE_URL}/auth/reset-password?token=${hashed_token}` }, 'Reset Your Password')\r\n            } catch (e) {\r\n                return reply.status(500).send('Error sending email')\r\n            }\r\n        }\r\n        return { success: true }\r\n    })\r\n\r\n    // Reset Password\r\n    fastify.put('/reset_password', {\r\n        schema: {\r\n            tags: ['user'],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    token: { type: 'string' },\r\n                    password: { type: 'string' }\r\n                },\r\n                required: ['email', 'password']\r\n            },\r\n            response: {\r\n                200: { properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const body = request.body as { password: string, token: string }\r\n        const password = body.password as string\r\n        if (password.length < 8) {\r\n            return reply.status(400).send({ message: 'Password must be at least 8 characters long' })\r\n        }\r\n        const token = body.token as string\r\n        const password_reset_token = await prisma.passwordResetToken.findFirst({\r\n            where: {\r\n                token: {\r\n                    equals: token\r\n                }\r\n            }\r\n        })\r\n        if (!password_reset_token) {\r\n            return reply.status(404).send('Password reset request was not found')\r\n        }\r\n        if (new Date() > password_reset_token.expiry_time) {\r\n            return reply.status(500).send('Token has expired')\r\n        }\r\n\r\n        const salt = await bcrypt.genSalt(10)\r\n        const hashed_password = await bcrypt.hash(password, salt)\r\n        const updated_user = await prisma.user.update({\r\n            data: {\r\n                hashed_password\r\n            },\r\n            where: {\r\n                id: password_reset_token.user_id\r\n            }\r\n        })\r\n        return { success: true }\r\n    })\r\n\r\n};\r\n\r\nexport default authRoutes"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/lib/safe_return_data.ts": {
      "lineLengths": [
        13,
        62,
        34,
        28,
        13,
        16,
        23,
        26,
        21,
        20,
        2,
        844
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/lib/safe_return_data.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/lib/safe_return_data.ts"
        ],
        "names": [],
        "mappings": ";;;AAAa,QAAA,gBAAgB,GAAG;IAC5B,EAAE,EAAE,IAAI;IACR,KAAK,EAAE,IAAI;IACX,YAAY,EAAE,IAAI;IAClB,eAAe,EAAE,IAAI;IACrB,UAAU,EAAE,IAAI;IAChB,UAAU,EAAE,IAAI;CACnB,CAAA",
        "sourcesContent": [
          "export const SAFE_USER_RETURN = {\r\n    id: true,\r\n    email: true,\r\n    display_name: true,\r\n    avatar_file_key: true,\r\n    created_at: true,\r\n    updated_at: true\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/resend/send_email.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        27,
        35,
        60,
        48,
        44,
        63,
        68,
        33,
        83,
        9,
        48,
        37,
        89,
        21,
        30,
        79,
        31,
        21,
        83,
        58,
        70,
        61,
        53,
        32,
        36,
        23,
        34,
        17,
        27,
        30,
        17,
        15,
        11,
        5,
        15,
        27,
        5,
        2,
        30,
        3880
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/resend/send_email.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/resend/send_email.ts"
        ],
        "names": [],
        "mappings": ";;;;;;AAAA,mCAAgC;AAEhC,4DAAoC;AACpC,gDAAwB;AACxB,4CAAmB;AACnB,MAAM,MAAM,GAAG,IAAI,eAAM,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;AAE/C,MAAM,SAAS,GAAG,KAAK,WAAW,QAAgB,EAAE,YAAiB,EAAE,OAAe;IACzF,6BAA6B;IAC7B,MAAM,YAAY,GAAG,cAAI,CAAC,IAAI,CAAC,SAAS,EAAE,eAAe,QAAQ,EAAE,CAAC,CAAC;IAErE,IAAI,CAAC;QACD,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YAClC,yBAAyB;YACzB,YAAE,CAAC,QAAQ,CAAC,YAAY,EAAE,MAAM,EAAE,KAAK,EAAE,GAAQ,EAAE,eAAoB,EAAE,EAAE;gBACvE,IAAI,CAAC;oBACD,IAAI,GAAG,EAAE,CAAC;wBACN,OAAO,CAAC,KAAK,CAAC,kCAAkC,EAAE,GAAG,CAAC,CAAC;wBACvD,OAAO;oBACX,CAAC;oBACD,MAAM,QAAQ,GAAG,oBAAU,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;oBACrD,MAAM,MAAM,GAAG,QAAQ,CAAC,YAAY,CAAC,CAAC;oBAEtC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC;wBAC7C,IAAI,EAAE,8BAA8B;wBACpC,EAAE,EAAE,CAAC,sBAAsB,CAAC;wBAC5B,OAAO;wBACP,IAAI,EAAE,MAAM;qBACf,CAAC,CAAC;oBACH,OAAO,CAAC,IAAI,CAAC,CAAA;gBACjB,CAAC;gBAAC,OAAO,CAAC,EAAE,CAAC;oBACT,MAAM,CAAC,CAAC,CAAC,CAAA;gBACb,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAA;IACN,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACT,MAAM,IAAI,KAAK,CAAC,CAAW,CAAC,CAAA;IAChC,CAAC;AACL,CAAC,CAAA;AA/BY,QAAA,SAAS,aA+BrB",
        "sourcesContent": [
          "import { Resend } from 'resend';\r\nimport pug from 'pug'\r\nimport Handlebars from 'handlebars';\r\nimport path from 'path';\r\nimport fs from 'fs'\r\nconst resend = new Resend(process.env.RESEND_API_KEY);\r\n\r\nexport const sendEmail = async function (template: string, templateData: any, subject: string) {\r\n    // Path to your HTML template\r\n    const templatePath = path.join(__dirname, `./templates/${template}`);\r\n\r\n    try {\r\n        await new Promise((resolve, reject) => {\r\n            // Read the template file\r\n            fs.readFile(templatePath, 'utf8', async (err: any, templateContent: any) => {\r\n                try {\r\n                    if (err) {\r\n                        console.error('Error reading the template file:', err);\r\n                        return;\r\n                    }\r\n                    const template = Handlebars.compile(templateContent);\r\n                    const result = template(templateData);\r\n\r\n                    const { data, error } = await resend.emails.send({\r\n                        from: 'Acme <onboarding@resend.dev>',\r\n                        to: ['delivered@resend.dev'],\r\n                        subject,\r\n                        html: result\r\n                    });\r\n                    resolve(data)\r\n                } catch (e) {\r\n                    reject(e)\r\n                }\r\n            });\r\n        })\r\n    } catch (e) {\r\n        throw new Error(e as string)\r\n    }\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.schema.ts": {
      "lineLengths": [
        13,
        62,
        36,
        62,
        30,
        19,
        17,
        31,
        34,
        41,
        44,
        39,
        72,
        39,
        48,
        48,
        5,
        2,
        1776
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.schema.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.schema.ts"
        ],
        "names": [],
        "mappings": ";;;AAAA,8DAA0E;AAE7D,QAAA,kBAAkB,GAAG;IAC9B,IAAI,EAAE,QAAQ;IACd,UAAU,EAAE;QACR,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACzB,YAAY,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAChC,eAAe,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACnC,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC9B,eAAe,EAAE,8CAA6B;QAC9C,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC9B,mBAAmB,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACvC,oBAAoB,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KAC3C;CACJ,CAAA",
        "sourcesContent": [
          "import { SCHEMA_MATCHUP_ENTRIES_RETURN } from \"../matchup/matchup.schema\";\r\n\r\nexport const SCHEMA_USER_RETURN = {\r\n    type: 'object',\r\n    properties: {\r\n        id: { type: 'string' },\r\n        email: { type: 'string' },\r\n        display_name: { type: 'string' },\r\n        avatar_file_key: { type: 'string' },\r\n        created_at: { type: 'string' },\r\n        matchup_entries: SCHEMA_MATCHUP_ENTRIES_RETURN,\r\n        updated_at: { type: 'string' },\r\n        strava_access_token: { type: 'string' },\r\n        strava_refresh_token: { type: 'string' }\r\n    }\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.schema.ts": {
      "lineLengths": [
        13,
        62,
        112,
        68,
        56,
        41,
        18,
        17,
        34,
        36,
        5,
        2,
        33,
        19,
        17,
        31,
        55,
        62,
        54,
        54,
        38,
        36,
        39,
        5,
        2,
        34,
        18,
        17,
        31,
        55,
        62,
        54,
        54,
        38,
        36,
        39,
        5,
        2,
        3168
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.schema.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.schema.ts"
        ],
        "names": [],
        "mappings": ";;;AAAA,oEAAwE;AACxE,wDAA4D;AAE/C,QAAA,6BAA6B,GAAG;IACzC,IAAI,EAAE,OAAO;IACb,UAAU,EAAE;QACR,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACzB,OAAO,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KAC9B;CACJ,CAAA;AAEY,QAAA,qBAAqB,GAAG;IACjC,IAAI,EAAE,QAAQ;IACd,UAAU,EAAE;QACR,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,OAAO,EAAE,qCAA6B;QACtC,SAAS,EAAE,0CAAuB;QAClC,SAAS,EAAE,kCAAmB;QAC9B,SAAS,EAAE,kCAAmB;QAC9B,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC7B,OAAO,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC3B,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KACjC;CACJ,CAAA;AAEY,QAAA,sBAAsB,GAAG;IAClC,IAAI,EAAE,OAAO;IACb,UAAU,EAAE;QACR,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,OAAO,EAAE,qCAA6B;QACtC,SAAS,EAAE,0CAAuB;QAClC,SAAS,EAAE,kCAAmB;QAC9B,SAAS,EAAE,kCAAmB;QAC9B,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC7B,OAAO,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC3B,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KACjC;CACJ,CAAA",
        "sourcesContent": [
          "import { SCHEMA_CHALLENGE_RETURN } from \"../challenge/challenge.schema\";\r\nimport { SCHEMA_SQUAD_RETURN } from \"../squad/squad.schema\";\r\n\r\nexport const SCHEMA_MATCHUP_ENTRIES_RETURN = {\r\n    type: 'array',\r\n    properties: {\r\n        value: { type: 'object' },\r\n        user_id: { type: 'string' },\r\n    }\r\n}\r\n\r\nexport const SCHEMA_MATCHUP_RETURN = {\r\n    type: 'object',\r\n    properties: {\r\n        id: { type: 'string' },\r\n        entries: SCHEMA_MATCHUP_ENTRIES_RETURN,\r\n        challenge: SCHEMA_CHALLENGE_RETURN,\r\n        squad_one: SCHEMA_SQUAD_RETURN,\r\n        squad_two: SCHEMA_SQUAD_RETURN,\r\n        starts_at: { type: 'string' },\r\n        ends_at: { type: 'string' },\r\n        created_at: { type: 'string' },\r\n    }\r\n}\r\n\r\nexport const SCHEMA_MATCHUPS_RETURN = {\r\n    type: 'array',\r\n    properties: {\r\n        id: { type: 'string' },\r\n        entries: SCHEMA_MATCHUP_ENTRIES_RETURN,\r\n        challenge: SCHEMA_CHALLENGE_RETURN,\r\n        squad_one: SCHEMA_SQUAD_RETURN,\r\n        squad_two: SCHEMA_SQUAD_RETURN,\r\n        starts_at: { type: 'string' },\r\n        ends_at: { type: 'string' },\r\n        created_at: { type: 'string' },\r\n    }\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.schema.ts": {
      "lineLengths": [
        13,
        62,
        76,
        35,
        19,
        17,
        31,
        34,
        33,
        33,
        40,
        5,
        2,
        36,
        18,
        58,
        2,
        1472
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.schema.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.schema.ts"
        ],
        "names": [],
        "mappings": ";;;AAAa,QAAA,uBAAuB,GAAG;IACnC,IAAI,EAAE,QAAQ;IACd,UAAU,EAAE;QACR,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACzB,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACxB,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACxB,WAAW,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KAClC;CACJ,CAAA;AAEY,QAAA,wBAAwB,GAAG;IACpC,IAAI,EAAE,OAAO;IACb,UAAU,EAAE,+BAAuB,CAAC,UAAU;CACjD,CAAA",
        "sourcesContent": [
          "export const SCHEMA_CHALLENGE_RETURN = {\r\n    type: 'object',\r\n    properties: {\r\n        id: { type: 'string' },\r\n        label: { type: 'string' },\r\n        type: { type: 'string' },\r\n        name: { type: 'string' },\r\n        description: { type: 'string' },\r\n    }\r\n}\r\n\r\nexport const SCHEMA_CHALLENGES_RETURN = {\r\n    type: 'array',\r\n    properties: SCHEMA_CHALLENGE_RETURN.properties\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.schema.ts": {
      "lineLengths": [
        13,
        62,
        107,
        31,
        19,
        17,
        64,
        31,
        33,
        35,
        34,
        33,
        35,
        31,
        37,
        40,
        39,
        39,
        5,
        2,
        40,
        18,
        17,
        36,
        37,
        38,
        5,
        2,
        32,
        18,
        17,
        64,
        31,
        33,
        35,
        37,
        40,
        39,
        39,
        5,
        2,
        3764
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.schema.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.schema.ts"
        ],
        "names": [],
        "mappings": ";;;AAAa,QAAA,mBAAmB,GAAG;IAC/B,IAAI,EAAE,QAAQ;IACd,UAAU,EAAE;QACR,MAAM,EAAE,EAAE,UAAU,EAAE,EAAE,OAAO,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,EAAC,EAAE;QACtD,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACxB,OAAO,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE;QAC1B,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACzB,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACxB,MAAM,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC1B,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,QAAQ,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC/B,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC9B,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KACjC;CACJ,CAAA;AAEY,QAAA,4BAA4B,GAAG;IACxC,IAAI,EAAE,OAAO;IACb,UAAU,EAAE;QACR,OAAO,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC3B,QAAQ,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC5B,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KACjC;CACJ,CAAA;AAEY,QAAA,oBAAoB,GAAG;IAChC,IAAI,EAAE,OAAO;IACb,UAAU,EAAE;QACR,MAAM,EAAE,EAAE,UAAU,EAAE,EAAE,OAAO,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,EAAC,EAAE;QACtD,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACxB,OAAO,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE;QAC1B,QAAQ,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC/B,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC9B,UAAU,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KACjC;CACJ,CAAA",
        "sourcesContent": [
          "export const SCHEMA_SQUAD_RETURN = {\r\n    type: 'object',\r\n    properties: {\r\n        _count: { properties: { members: { type: 'number' }} },\r\n        id: { type: 'string' },\r\n        name: { type: 'string' },\r\n        members: { type: 'array' },\r\n        level: { type: 'string' },\r\n        wins: { type: 'number' },\r\n        losses: { type: 'number' },\r\n        xp: { type: 'number' },\r\n        owner_id: { type: 'string' },\r\n        description: { type: 'string' },\r\n        created_at: { type: 'string' },\r\n        updated_at: { type: 'string' },\r\n    }\r\n}\r\n\r\nexport const SCHEMA_SQUADS_REQUEST_RETURN = {\r\n    type: 'array',\r\n    properties: { \r\n        user_id: { type: 'string' },\r\n        squad_id: { type: 'string' }, \r\n        created_at: { type: 'string' }\r\n    }\r\n}\r\n\r\nexport const SCHEMA_SQUADS_RETURN = {\r\n    type: 'array',\r\n    properties: {\r\n        _count: { properties: { members: { type: 'number' }} },\r\n        id: { type: 'string' },\r\n        name: { type: 'string' },\r\n        members: { type: 'array' },\r\n        owner_id: { type: 'string' },\r\n        description: { type: 'string' },\r\n        created_at: { type: 'string' },\r\n        updated_at: { type: 'string' },\r\n    }\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/db.ts": {
      "lineLengths": [
        13,
        62,
        24,
        43,
        45,
        724
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/db.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/db.ts"
        ],
        "names": [],
        "mappings": ";;;AAAA,2CAAmD;AACtC,QAAA,MAAM,GAAG,IAAI,qBAAY,EAAE,CAAA",
        "sourcesContent": [
          "import { PrismaClient, User } from '@prisma/client'\r\nexport const prisma = new PrismaClient()\r\n\r\n// Fastify request extension\r\ndeclare module 'fastify' {\r\n    interface FastifyRequest {\r\n        user?: User\r\n    }\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.controller.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        42,
        44,
        64,
        32,
        146,
        1,
        33,
        154,
        1,
        1728
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.controller.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/auth/auth.controller.ts"
        ],
        "names": [],
        "mappings": ";;;;;AAEA,0CAEC;AAED,4CAEC;AAPD,gEAA8B;AAC9B,SAAgB,eAAe,CAAE,IAAU;IACvC,OAAO,sBAAG,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,OAAO,CAAC,GAAG,CAAC,UAAoB,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC,CAAC;AACzI,CAAC;AAED,SAAgB,gBAAgB,CAAE,IAAU;IACxC,OAAO,sBAAG,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,OAAO,CAAC,GAAG,CAAC,kBAA4B,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC,CAAC;AACjJ,CAAC",
        "sourcesContent": [
          "import { User } from \"@prisma/client\";\r\nimport jwt from 'jsonwebtoken'\r\nexport function signAccessToken (user: User) {\r\n    return jwt.sign({ name: user.display_name, email: user.email, id: user.id }, process.env.JWT_SECRET as string, { expiresIn: '15m' });\r\n}\r\n\r\nexport function signRefreshToken (user: User) {\r\n    return jwt.sign({ name: user.display_name, email: user.email, id: user.id }, process.env.JWT_REFRESH_SECRET as string, { expiresIn: '30d' });\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.routes.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        68,
        52,
        47,
        33,
        39,
        24,
        50,
        17,
        43,
        39,
        27,
        19,
        31,
        29,
        56,
        60,
        61,
        52,
        17,
        14,
        23,
        53,
        13,
        9,
        34,
        15,
        13,
        38,
        31,
        61,
        57,
        13,
        64,
        69,
        58,
        13,
        68,
        71,
        13,
        69,
        73,
        13,
        56,
        30,
        24,
        86,
        17,
        15,
        24,
        64,
        13,
        24,
        9,
        19,
        45,
        9,
        7,
        24,
        50,
        17,
        43,
        41,
        27,
        23,
        53,
        13,
        9,
        34,
        15,
        13,
        59,
        24,
        86,
        17,
        15,
        24,
        64,
        13,
        24,
        9,
        19,
        45,
        9,
        7,
        2,
        29,
        7736
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/user/user.routes.ts"
        ],
        "names": [],
        "mappings": "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",
        "sourcesContent": [
          "import { FastifyPluginAsync } from \"fastify\";\r\nimport { authenticate } from \"../../middleware/authentication\";\r\nimport { User } from \"@prisma/client\";\r\nimport _ from \"lodash\";\r\nimport { SCHEMA_USER_RETURN } from \"./user.schema\";\r\nimport { prisma } from \"../../db\";\r\n\r\nconst userRoutes: FastifyPluginAsync = async (fastify) => {\r\n    fastify.put('/me', {\r\n        preHandler: authenticate,\r\n        schema: {\r\n            security: [{ bearerAuth: [] }],\r\n            description: 'Update user',\r\n            tags: ['user'],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    avatar_file_key: { type: 'string' },\r\n                    strava_access_token: { type: 'string' },\r\n                    strava_refresh_token: { type: 'string' },\r\n                    display_name: { type: 'string' }\r\n                }\r\n            },\r\n            response: {\r\n                200: SCHEMA_USER_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const body = request.body as Partial<User>\r\n            const payload = {} as User\r\n            if (_.has(body, 'display_name')) {\r\n                payload.display_name = body.display_name as string\r\n            }\r\n            if (_.has(body, 'avatar_file_key')) {\r\n                const avatar_file_key = body.avatar_file_key || null\r\n                payload.avatar_file_key = avatar_file_key\r\n            }\r\n            if (_.has(body, 'strava_access_token')) {\r\n                payload.strava_access_token = body.strava_access_token as string\r\n            }\r\n            if (_.has(body, 'strava_refresh_token')) {\r\n                payload.strava_refresh_token = body.strava_refresh_token as string\r\n            }\r\n            const user = await prisma.user.update({\r\n                data: payload,\r\n                where: {\r\n                    id: request.user?.id\r\n                }\r\n            })\r\n            if (!user) {\r\n                return reply.status(404).send('User not found')\r\n            }\r\n            return user\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n    fastify.get('/me', {\r\n        preHandler: authenticate,\r\n        schema: {\r\n            security: [{ bearerAuth: [] }],\r\n            description: 'Fetch me data',\r\n            tags: ['user'],\r\n            response: {\r\n                200: SCHEMA_USER_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const user = await prisma.user.findFirst({\r\n                where: {\r\n                    id: request.user?.id\r\n                }\r\n            })\r\n            if (!user) {\r\n                return reply.status(404).send('User not found')\r\n            }\r\n            return user\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n}\r\n\r\nexport default userRoutes"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authentication.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        30,
        64,
        48,
        56,
        22,
        98,
        5,
        9,
        103,
        90,
        27,
        40,
        9,
        5,
        15,
        98,
        5,
        11,
        2,
        36,
        2444
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authentication.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authentication.ts"
        ],
        "names": [],
        "mappings": ";;;;;;AAEA,gEAA8B;AACvB,MAAM,YAAY,GAAG,CAAC,OAAuB,EAAE,KAAmB,EAAE,IAA2B,EAAE,EAAE;IACtG,MAAM,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC,CAAA;IACnD,IAAI,CAAC,UAAU,EAAE,CAAC;QACd,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,0DAA0D,CAAC,CAAA;IAC7F,CAAC;IACD,IAAI,CAAC;QACD,MAAM,KAAK,GAAW,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,KAAK,CAAC,GAAG,EAAE,CAAC,CAAE,CAAA;QAChD,MAAM,YAAY,GAAG,sBAAG,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,UAAoB,CAAC,CAAA;QACxE,IAAI,YAAY,EAAE,CAAC;YACf,OAAO,CAAC,IAAI,GAAG,YAAoB,CAAA;QACvC,CAAC;IACL,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACT,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,0DAA0D,CAAC,CAAA;IAC7F,CAAC;IACD,IAAI,EAAE,CAAA;AACV,CAAC,CAAA;AAfY,QAAA,YAAY,gBAexB",
        "sourcesContent": [
          "import { User } from \"@prisma/client\";\r\nimport { FastifyReply, FastifyRequest } from \"fastify\";\r\nimport jwt from 'jsonwebtoken'\r\nexport const authenticate = (request: FastifyRequest, reply: FastifyReply, done: (err?: Error) => void) => {\r\n    const authHeader = request.headers['authorization']\r\n    if (!authHeader) {\r\n        return reply.status(403).send('You do have not have permissions to access this resource')\r\n    }\r\n    try {\r\n        const token: string = authHeader?.split(' ')[1]!\r\n        const decodedToken = jwt.verify(token, process.env.JWT_SECRET as string)\r\n        if (decodedToken) {\r\n            request.user = decodedToken as User\r\n        }\r\n    } catch (e) {\r\n        return reply.status(401).send('You do have not have permissions to access this resource')\r\n    }\r\n    done()\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.routes.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        68,
        52,
        49,
        45,
        56,
        70,
        33,
        40,
        29,
        60,
        54,
        43,
        28,
        19,
        31,
        29,
        67,
        75,
        65,
        18,
        49,
        14,
        23,
        55,
        13,
        9,
        34,
        15,
        13,
        38,
        35,
        90,
        49,
        60,
        65,
        24,
        36,
        17,
        15,
        30,
        100,
        13,
        71,
        24,
        24,
        18,
        25,
        30,
        17,
        15,
        141,
        103,
        13,
        73,
        42,
        27,
        36,
        35,
        41,
        48,
        21,
        19,
        48,
        27,
        42,
        40,
        21,
        18,
        15,
        49,
        9,
        19,
        45,
        9,
        7,
        25,
        60,
        51,
        43,
        26,
        31,
        29,
        46,
        46,
        52,
        46,
        17,
        14,
        28,
        23,
        56,
        13,
        9,
        34,
        67,
        13,
        27,
        24,
        25,
        27,
        40,
        43,
        21,
        18,
        13,
        68,
        36,
        38,
        18,
        13,
        61,
        34,
        34,
        22,
        25,
        33,
        29,
        31,
        35,
        30,
        33,
        35,
        41,
        45,
        54,
        33,
        29,
        25,
        22,
        37,
        17,
        15,
        26,
        9,
        19,
        45,
        9,
        7,
        25,
        60,
        45,
        43,
        21,
        31,
        29,
        42,
        17,
        14,
        28,
        23,
        55,
        13,
        9,
        34,
        15,
        38,
        13,
        61,
        38,
        30,
        31,
        99,
        25,
        21,
        27,
        25,
        33,
        29,
        31,
        32,
        35,
        38,
        33,
        31,
        29,
        30,
        33,
        45,
        35,
        41,
        58,
        45,
        54,
        33,
        29,
        25,
        22,
        17,
        15,
        25,
        78,
        13,
        25,
        9,
        19,
        45,
        9,
        7,
        25,
        60,
        42,
        21,
        31,
        29,
        42,
        17,
        14,
        19,
        31,
        29,
        45,
        51,
        18,
        49,
        14,
        43,
        28,
        23,
        55,
        13,
        9,
        34,
        15,
        38,
        51,
        27,
        19,
        32,
        9,
        26,
        46,
        9,
        13,
        58,
        30,
        24,
        23,
        92,
        18,
        25,
        29,
        31,
        34,
        38,
        37,
        37,
        17,
        15,
        25,
        9,
        19,
        45,
        9,
        7,
        41,
        100,
        60,
        21,
        31,
        29,
        42,
        17,
        14,
        19,
        31,
        29,
        47,
        17,
        14,
        43,
        28,
        23,
        69,
        13,
        9,
        34,
        38,
        41,
        13,
        80,
        24,
        28,
        32,
        17,
        15,
        33,
        90,
        13,
        44,
        48,
        27,
        37,
        40,
        21,
        19,
        53,
        28,
        43,
        41,
        35,
        25,
        21,
        18,
        15,
        61,
        9,
        19,
        45,
        9,
        7,
        28,
        100,
        45,
        21,
        31,
        29,
        42,
        17,
        14,
        43,
        28,
        23,
        69,
        13,
        9,
        34,
        38,
        13,
        44,
        52,
        28,
        36,
        21,
        19,
        57,
        28,
        36,
        21,
        19,
        42,
        28,
        26,
        21,
        18,
        15,
        37,
        9,
        19,
        45,
        9,
        7,
        34,
        100,
        57,
        21,
        31,
        29,
        42,
        17,
        14,
        43,
        28,
        23,
        64,
        13,
        9,
        34,
        38,
        13,
        79,
        24,
        32,
        18,
        25,
        37,
        27,
        33,
        37,
        50,
        46,
        25,
        21,
        17,
        15,
        33,
        9,
        19,
        45,
        9,
        7,
        34,
        60,
        58,
        21,
        31,
        29,
        42,
        17,
        14,
        19,
        31,
        29,
        47,
        17,
        14,
        43,
        28,
        23,
        69,
        13,
        9,
        34,
        38,
        41,
        13,
        73,
        24,
        27,
        17,
        15,
        30,
        101,
        13,
        80,
        24,
        28,
        32,
        17,
        15,
        32,
        111,
        13,
        76,
        23,
        33,
        27,
        18,
        25,
        28,
        33,
        38,
        25,
        22,
        27,
        33,
        46,
        25,
        21,
        17,
        15,
        230,
        61,
        9,
        19,
        45,
        9,
        7,
        2,
        30,
        38120
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/squad/squad.routes.ts"
        ],
        "names": [],
        "mappings": "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",
        "sourcesContent": [
          "import { FastifyPluginAsync } from \"fastify\";\r\nimport { authenticate } from \"../../middleware/authentication\";\r\nimport { Prisma, Squad } from \"@prisma/client\";\r\nimport _ from \"lodash\";\r\nimport { SCHEMA_SQUAD_RETURN, SCHEMA_SQUADS_REQUEST_RETURN, SCHEMA_SQUADS_RETURN } from \"./squad.schema\";\r\nimport { randomUUID } from \"node:crypto\";\r\nimport { sendEmail } from \"../../resend/send_email\";\r\nimport { squadAuthorization } from \"../../middleware/authorize_squad\";\r\nimport { prisma } from \"../../db\";\r\n\r\nconst squadRoutes: FastifyPluginAsync = async (fastify) => {\r\n    fastify.post('/create', {\r\n        preHandler: authenticate, schema: {\r\n            description: 'Create a new running squad',\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['squad'],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    is_public: { type: 'boolean', default: false },\r\n                    name: { type: 'string', minLength: 1, maxLength: 100 },\r\n                    description: { type: 'string', minLength: 1 }\r\n                },\r\n                required: ['name', 'description']\r\n            },\r\n            response: {\r\n                201: SCHEMA_SQUAD_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const body = request.body as Partial<Squad>\r\n            const name = body.name\r\n            const userId = request.user?.id\r\n            const description = body.description\r\n            const squadId = randomUUID()\r\n            const ownsSquad = await prisma.squad.findFirst({\r\n                where: {\r\n                    owner_id: userId\r\n                }\r\n            })\r\n            if (!!ownsSquad) {\r\n                return reply.status(500).send({ message: 'You may only be a member of one squad' })\r\n            }\r\n            const squadNameExists = await prisma.squad.findFirst({\r\n                where: {\r\n                    name\r\n                },\r\n                select: {\r\n                    name: true\r\n                }\r\n            })\r\n            if (squadNameExists && squadNameExists.name.toLowerCase() === name?.toLowerCase()) {\r\n                return reply.status(500).send({ message: `Squad with name '${name}' already exists` })\r\n            }\r\n            const [squad, squadMember] = await prisma.$transaction([\r\n                prisma.squad.create({\r\n                    data: {\r\n                        id: squadId,\r\n                        name: name!,\r\n                        owner_id: userId!,\r\n                        description: description!\r\n                    }\r\n                }),\r\n                prisma.squadMember.create({\r\n                    data: {\r\n                        squad_id: squadId,\r\n                        user_id: userId!,\r\n                    }\r\n                })\r\n            ])\r\n            return reply.status(201).send(squad)\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n\r\n    fastify.get('/all', {\r\n        preHandler: authenticate, schema: {\r\n            description: 'Fetch all public squads',\r\n            security: [{ bearerAuth: [] }],\r\n            querystring: {\r\n                type: 'object',\r\n                properties: {\r\n                    limit: { type: 'number' },\r\n                    query: { type: 'string' },\r\n                    is_engaged: { type: 'boolean' },\r\n                    offset: { type: 'number' }\r\n                }\r\n            },\r\n            tags: ['squad'],\r\n            response: {\r\n                200: SCHEMA_SQUADS_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { limit, offset, query, is_engaged} = request.query as { limit?: number, offset?: number, query?: string, is_engaged?: boolean }\r\n        try {\r\n            let where = {} as Prisma.SquadWhereInput\r\n            if (query) {\r\n                where = {\r\n                    name: {\r\n                        contains: query,\r\n                        mode: 'insensitive'\r\n                    }\r\n                }\r\n            } if (_.has(request.query, 'is_engaged')) {\r\n                where.is_engaged = {\r\n                    equals: is_engaged\r\n                }\r\n            }\r\n            const squads = await prisma.squad.findMany({\r\n                take: limit || 10,\r\n                skip: offset || 0,\r\n                where,\r\n                select: {\r\n                    _count: true,\r\n                    id: true,\r\n                    name: true,\r\n                    owner_id: true,\r\n                    members: {\r\n                        select: {\r\n                            user: {\r\n                                select: {\r\n                                    id: true,\r\n                                    display_name: true\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    description: true\r\n                }\r\n            })\r\n            return squads\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n\r\n    fastify.get('/:id', {\r\n        preHandler: authenticate, schema: {\r\n            description: 'Fetch squad by ID',\r\n            security: [{ bearerAuth: [] }],\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            tags: ['squad'],\r\n            response: {\r\n                200: SCHEMA_SQUAD_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        try {\r\n            const squad = await prisma.squad.findFirst({\r\n                where: id === 'me' ? {\r\n                    members: {\r\n                        some: {\r\n                            user_id: request.user?.id\r\n                        }\r\n                    }\r\n                } : { id },\r\n                select: {\r\n                    _count: true,\r\n                    id: true,\r\n                    name: true,\r\n                    level: true,\r\n                    owner_id: true,\r\n                    description: true,\r\n                    losses: true,\r\n                    wins: true,\r\n                    xp: true,\r\n                    members: {\r\n                        select: {\r\n                            created_at: true,\r\n                            user: {\r\n                                select: {\r\n                                    avatar_file_key: true,\r\n                                    id: true,\r\n                                    display_name: true\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n\r\n                }\r\n            })\r\n            if (!squad) {\r\n                return reply.status(404).send({ message: 'Squad not found' })\r\n            }\r\n            return squad\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n\r\n    fastify.put('/:id', {\r\n        preHandler: authenticate, schema: {\r\n            description: 'Update a squad',\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    name: { type: 'string' },\r\n                    description: { type: 'string' }\r\n                },\r\n                required: ['name', 'description']\r\n            },\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['squad'],\r\n            response: {\r\n                200: SCHEMA_SQUAD_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        const { name, description } = request.body as { name?: string, description?: string }\r\n        const payload: Partial<Squad> = {}\r\n        if (name) {\r\n            payload.name = name\r\n        }\r\n        if (description) {\r\n            payload.description = description\r\n        }\r\n        try {\r\n            const squad = await prisma.squad.update({\r\n                data: payload,\r\n                where: {\r\n                    id,\r\n                    owner_id: request.user?.id\r\n                },\r\n                select: {\r\n                    id: true,\r\n                    name: true,\r\n                    members: true,\r\n                    description: true,\r\n                    created_at: true,\r\n                    updated_at: true,\r\n                }\r\n            })\r\n            return squad\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n\r\n    fastify.post('/:id/accept_request', {\r\n        preHandler: [authenticate, squadAuthorization], schema: {\r\n            description: 'Accept a request to join a squad',\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    user_id: { type: 'string' }\r\n                }\r\n            },\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['squad'],\r\n            response: {\r\n                201: { properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        const { user_id } = request.body as { user_id: string }\r\n        try {\r\n            const requestExists = await prisma.squadJoinRequest.findFirst({\r\n                where: {\r\n                    user_id,\r\n                    squad_id: id\r\n                }\r\n            })\r\n            if (!requestExists) {\r\n                return reply.status(409).send({ message: 'This request does not exist' })\r\n            }\r\n            await prisma.$transaction([\r\n                prisma.squadMember.create({\r\n                    data: {\r\n                        squad_id: id,\r\n                        user_id: user_id\r\n                    }\r\n                }),\r\n                prisma.squadJoinRequest.delete({\r\n                    where: {\r\n                        user_id_squad_id: {\r\n                            squad_id: id,\r\n                            user_id\r\n                        }\r\n                    }\r\n                })\r\n            ])\r\n            return reply.status(200).send({ success: true })\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n\r\n    fastify.delete('/:id', {\r\n        preHandler: [authenticate, squadAuthorization], schema: {\r\n            description: 'Delete your squad',\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['squad'],\r\n            response: {\r\n                200: { properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        try {\r\n            await prisma.$transaction([\r\n                prisma.squadMember.deleteMany({\r\n                    where: {\r\n                        squad_id: id\r\n                    }\r\n                }),\r\n                prisma.squadJoinRequest.deleteMany({\r\n                    where: {\r\n                        squad_id: id\r\n                    }\r\n                }),\r\n                prisma.squad.delete({\r\n                    where: {\r\n                        id\r\n                    }\r\n                })\r\n            ])\r\n            return { success: true }\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n\r\n    fastify.get('/:id/requests', {\r\n        preHandler: [authenticate, squadAuthorization], schema: {\r\n            description: 'View requests to join a squad',\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['squad'],\r\n            response: {\r\n                200: SCHEMA_SQUADS_REQUEST_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        try {\r\n            const requestExists = await prisma.squadJoinRequest.findMany({\r\n                where: {\r\n                    squad_id: id\r\n                },\r\n                select: {\r\n                    created_at: true,\r\n                    user: {\r\n                        select: {\r\n                            id: true,\r\n                            avatar_file_key: true,\r\n                            display_name: true\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            return requestExists\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n\r\n    fastify.post('/:id/request', {\r\n        preHandler: authenticate, schema: {\r\n            description: 'Send a request to join a squad',\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    user_id: { type: 'string' }\r\n                }\r\n            },\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['squad'],\r\n            response: {\r\n                201: { properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        const { user_id } = request.body as { user_id: string }\r\n        try {\r\n            const squadMember = await prisma.squadMember.findFirst({\r\n                where: {\r\n                    user_id\r\n                }\r\n            })\r\n            if (squadMember) {\r\n                return reply.status(500).send({ message: 'You can only be a member of one squad.' })\r\n            }\r\n            const requestExists = await prisma.squadJoinRequest.findFirst({\r\n                where: {\r\n                    user_id,\r\n                    squad_id: id\r\n                }\r\n            })\r\n            if (requestExists) {\r\n                return reply.status(409).send({ message: 'Join request has already been sent to this squad' })\r\n            }\r\n            const squadRequest = await prisma.squadJoinRequest.create({\r\n                data: {\r\n                    squad_id: id,\r\n                    user_id\r\n                },\r\n                select: {\r\n                    squad: {\r\n                        select: {\r\n                            name: true\r\n                        }\r\n                    },\r\n                    user: {\r\n                        select: {\r\n                            display_name: true\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            await sendEmail('join_squad.html', { url: `${process.env.WEB_BASE_URL}/squad/${id}/join_requests`, name: squadRequest.squad.name, display_name: squadRequest.user.display_name }, 'Join Squad Request')\r\n            return reply.status(201).send({ success: true })\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n}\r\n\r\nexport default squadRoutes"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_squad.ts": {
      "lineLengths": [
        13,
        62,
        36,
        30,
        54,
        11,
        82,
        33,
        16,
        28,
        9,
        24,
        88,
        105,
        9,
        15,
        7,
        2,
        48,
        1896
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_squad.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_squad.ts"
        ],
        "names": [],
        "mappings": ";;;AAEA,8BAA+B;AACxB,MAAM,kBAAkB,GAAG,CAAC,OAAuB,EAAE,KAAmB,EAAE,IAA2B,EAAE,EAAE;;IAC5G,MAAM,MAAM,GAAG,MAAA,OAAO,CAAC,IAAI,0CAAE,EAAE,CAAA;IAC/B,WAAM,CAAC,KAAK,CAAC,SAAS,CAAC;QACnB,KAAK,EAAE;YACH,QAAQ,EAAE,MAAM;SACnB;KACJ,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;QACd,IAAI,CAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,QAAQ,MAAK,MAAM,EAAE,CAAC;YAC7B,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,gDAAgD,EAAE,CAAC,CAAA;QAChG,CAAC;QACD,IAAI,EAAE,CAAA;IACV,CAAC,CAAC,CAAA;AACN,CAAC,CAAA;AAZY,QAAA,kBAAkB,sBAY9B",
        "sourcesContent": [
          "import { FastifyReply, FastifyRequest } from \"fastify\";\r\nimport _ from \"lodash\";\r\nimport { prisma } from \"../db\";\r\nexport const squadAuthorization = (request: FastifyRequest, reply: FastifyReply, done: (err?: Error) => void) => {\r\n    const userId = request.user?.id\r\n    prisma.squad.findFirst({\r\n        where: {\r\n            owner_id: userId\r\n        }\r\n    }).then((squad) => {\r\n        if (squad?.owner_id !== userId) {\r\n            return reply.status(401).send({ message: 'You are not authorized to access this resource' })\r\n        }\r\n        done()\r\n    })\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/member/member.routes.ts": {
      "lineLengths": [
        13,
        62,
        68,
        70,
        33,
        41,
        43,
        100,
        56,
        43,
        29,
        21,
        31,
        29,
        48,
        48,
        17,
        14,
        23,
        69,
        13,
        9,
        34,
        13,
        57,
        50,
        24,
        28,
        35,
        34,
        47,
        29,
        25,
        22,
        39,
        32,
        32,
        21,
        18,
        15,
        37,
        9,
        19,
        45,
        9,
        7,
        2,
        31,
        4216
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/member/member.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/member/member.routes.ts"
        ],
        "names": [],
        "mappings": ";;AACA,oEAA8D;AAC9D,sEAAqE;AACrE,iCAAiC;AAEjC,MAAM,YAAY,GAAuB,KAAK,EAAE,OAAO,EAAE,EAAE;IACvD,OAAO,CAAC,MAAM,CAAC,qBAAqB,EAAE;QAClC,UAAU,EAAE,CAAC,6BAAY,EAAE,oCAAkB,CAAC,EAAE,MAAM,EAAE;YACpD,WAAW,EAAE,8BAA8B;YAC3C,QAAQ,EAAE,CAAC,EAAE,UAAU,EAAE,EAAE,EAAE,CAAC;YAC9B,IAAI,EAAE,CAAC,QAAQ,CAAC;YAChB,MAAM,EAAE;gBACJ,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE;oBACR,OAAO,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;oBAC3B,QAAQ,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;iBAC/B;aACJ;YACD,QAAQ,EAAE;gBACN,GAAG,EAAE,EAAE,UAAU,EAAE,EAAE,OAAO,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,EAAE;aACxD;SACJ;KACJ,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;QACxB,IAAI,CAAC;YACD,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,OAAO,CAAC,MAA+C,CAAA;YACrF,MAAM,WAAM,CAAC,WAAW,CAAC,MAAM,CAAC;gBAC5B,KAAK,EAAE;oBACH,KAAK,EAAE;wBACH,QAAQ,EAAE;4BACN,GAAG,EAAE;gCACD,MAAM,EAAE,OAAO;6BAClB;yBACJ;qBACJ;oBACD,gBAAgB,EAAE;wBACd,OAAO;wBACP,QAAQ;qBACX;iBACJ;aACJ,CAAC,CAAA;YACF,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAA;QAC5B,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACT,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAW,CAAC,CAAA;QAC9C,CAAC;IACL,CAAC,CAAC,CAAA;AACN,CAAC,CAAA;AAED,kBAAe,YAAY,CAAA",
        "sourcesContent": [
          "import { FastifyPluginAsync } from \"fastify\"\r\nimport { authenticate } from \"../../middleware/authentication\"\r\nimport { squadAuthorization } from \"../../middleware/authorize_squad\"\r\nimport { prisma } from \"../../db\"\r\n\r\nconst memberRoutes: FastifyPluginAsync = async (fastify) => {\r\n    fastify.delete('/:user_id/:squad_id', {\r\n        preHandler: [authenticate, squadAuthorization], schema: {\r\n            description: 'Remove a member from a squad',\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['member'],\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    user_id: { type: 'string' },\r\n                    squad_id: { type: 'string' }\r\n                }\r\n            },\r\n            response: {\r\n                200: { properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const { user_id, squad_id } = request.params as { user_id: string, squad_id: string }\r\n            await prisma.squadMember.delete({\r\n                where: {\r\n                    squad: {\r\n                        owner_id: {\r\n                            not: {\r\n                                equals: user_id\r\n                            }\r\n                        }\r\n                    },\r\n                    user_id_squad_id: {\r\n                        user_id,\r\n                        squad_id\r\n                    }\r\n                },\r\n            })\r\n            return { success: true }\r\n        } catch (e) {\r\n            return reply.status(500).send(e as string)\r\n        }\r\n    })\r\n}\r\n\r\nexport default memberRoutes"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.routes.ts": {
      "lineLengths": [
        13,
        62,
        55,
        68,
        76,
        33,
        63,
        43,
        29,
        50,
        17,
        43,
        46,
        31,
        19,
        31,
        29,
        45,
        49,
        47,
        55,
        51,
        50,
        59,
        63,
        18,
        152,
        14,
        23,
        61,
        13,
        9,
        34,
        15,
        142,
        13,
        84,
        96,
        13,
        72,
        24,
        29,
        17,
        15,
        32,
        103,
        13,
        72,
        26,
        35,
        18,
        24,
        37,
        30,
        53,
        22,
        32,
        53,
        22,
        25,
        25,
        40,
        42,
        43,
        64,
        37,
        33,
        29,
        26,
        25,
        40,
        42,
        43,
        64,
        37,
        33,
        29,
        25,
        21,
        17,
        15,
        64,
        23,
        25,
        45,
        29,
        32,
        36,
        27,
        30,
        39,
        43,
        17,
        15,
        33,
        118,
        13,
        28,
        9,
        19,
        58,
        9,
        7,
        25,
        96,
        17,
        43,
        46,
        31,
        21,
        31,
        29,
        42,
        17,
        14,
        19,
        31,
        29,
        44,
        18,
        34,
        14,
        23,
        61,
        13,
        9,
        34,
        15,
        38,
        38,
        13,
        84,
        96,
        13,
        64,
        24,
        22,
        18,
        23,
        24,
        17,
        15,
        28,
        9,
        19,
        58,
        9,
        7,
        28,
        96,
        17,
        43,
        43,
        31,
        21,
        31,
        29,
        42,
        17,
        14,
        23,
        69,
        13,
        9,
        34,
        15,
        38,
        13,
        47,
        24,
        23,
        91,
        17,
        15,
        37,
        9,
        19,
        58,
        9,
        7,
        28,
        52,
        17,
        47,
        43,
        31,
        23,
        63,
        13,
        9,
        34,
        15,
        13,
        68,
        24,
        91,
        17,
        15,
        30,
        9,
        19,
        58,
        9,
        7,
        25,
        96,
        17,
        42,
        43,
        31,
        21,
        31,
        29,
        42,
        17,
        14,
        23,
        61,
        13,
        9,
        34,
        38,
        13,
        67,
        24,
        22,
        18,
        26,
        27,
        33,
        47,
        49,
        25,
        21,
        17,
        15,
        28,
        68,
        13,
        28,
        9,
        19,
        58,
        9,
        7,
        38,
        52,
        17,
        57,
        43,
        31,
        23,
        63,
        13,
        9,
        34,
        15,
        45,
        13,
        25,
        29,
        45,
        13,
        68,
        24,
        92,
        32,
        62,
        21,
        18,
        15,
        36,
        9,
        19,
        58,
        9,
        7,
        2,
        33,
        23260
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.routes.ts"
        ],
        "names": [],
        "mappings": "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",
        "sourcesContent": [
          "import { FastifyPluginAsync } from \"fastify\"\r\nimport { SCHEMA_ACTIVITIES_RETURN, SCHEMA_ACTIVITY_RETURN } from \"./activity.schema\";\r\nimport { Activity, Challenge, Matchup } from \"@prisma/client\";\r\nimport { authenticate } from \"../../middleware/authentication\";\r\nimport { activityAuthorization } from \"../../middleware/authorize_activity\";\r\nimport _ from \"lodash\";\r\nimport { prisma } from \"../../db\";\r\nimport { processActivityForMatchup } from \"./activity.controller\";\r\n\r\nconst activityRoutes: FastifyPluginAsync = async (fastify) => {\r\n\r\n    fastify.post('/import', {\r\n        preHandler: authenticate,\r\n        schema: {\r\n            security: [{ bearerAuth: [] }],\r\n            description: 'Import an activity',\r\n            tags: ['activity'],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    name: { type: 'string' },\r\n                    polyline: { type: 'string' },\r\n                    source: { type: 'string' },\r\n                    distance_series: { type: 'array' },\r\n                    time_series: { type: 'array' },\r\n                    source_id: { type: 'string' },\r\n                    distance_in_meters: { type: 'number' },\r\n                    elapsed_time_in_seconds: { type: 'number' }\r\n                },\r\n                required: ['name', 'polyline', 'source', 'source_id', 'distance_in_meters', 'elapsed_time_in_seconds', 'time_series', 'distance_series']\r\n            },\r\n            response: {\r\n                201: SCHEMA_ACTIVITY_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { name, polyline, source, source_id, distance_in_meters, elapsed_time_in_seconds, time_series, distance_series } = request.body as Activity\r\n\r\n        try {\r\n            if (!request.user?.id) {\r\n                return reply.status(403).send('You are not authorized to access this resource')\r\n            }\r\n            const foundActivity = await prisma.activity.findFirst({\r\n                where: {\r\n                    source_id\r\n                }\r\n            })\r\n            if (foundActivity) {\r\n                return reply.status(400).send({ message: `Activity from ${source} already imported` })\r\n            }\r\n            const currentMatchup = await prisma.matchup.findFirst({\r\n                include: {\r\n                    challenge: true\r\n                },\r\n                where: {\r\n                    completed: false,\r\n                    ends_at: {\r\n                        gte: new Date().toISOString()\r\n                    },\r\n                    starts_at: {\r\n                        lte: new Date().toISOString()\r\n                    },\r\n                    OR: [\r\n                        {\r\n                            squad_one: {\r\n                                members: {\r\n                                    some: {\r\n                                        user_id: request.user.id\r\n                                    }\r\n                                }\r\n                            }\r\n                        },\r\n                        {\r\n                            squad_two: {\r\n                                members: {\r\n                                    some: {\r\n                                        user_id: request.user.id\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            })\r\n            const activity = await prisma.activity.create({\r\n                data: {\r\n                    name,\r\n                    user_id: request.user.id,\r\n                    polyline,\r\n                    time_series,\r\n                    distance_series,\r\n                    source,\r\n                    source_id,\r\n                    distance_in_meters,\r\n                    elapsed_time_in_seconds\r\n                }\r\n            })\r\n            if (currentMatchup) {\r\n                await processActivityForMatchup(request.user.id, activity, currentMatchup)\r\n            }\r\n            return activity\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    });\r\n\r\n    fastify.put('/:id', {\r\n        preHandler: [authenticate, activityAuthorization],\r\n        schema: {\r\n            security: [{ bearerAuth: [] }],\r\n            description: 'Update an activity',\r\n            tags: ['activity'],\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    name: { type: 'string' }\r\n                },\r\n                required: ['name']\r\n            },\r\n            response: {\r\n                200: SCHEMA_ACTIVITY_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { name } = request.body as Activity\r\n        const { id } = request.params as { id: string }\r\n        try {\r\n            if (!request.user?.id) {\r\n                return reply.status(403).send('You are not authorized to access this resource')\r\n            }\r\n            const activity = await prisma.activity.update({\r\n                where: {\r\n                    id\r\n                },\r\n                data: {\r\n                    name\r\n                }\r\n            })\r\n            return activity\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    });\r\n\r\n    fastify.delete('/:id', {\r\n        preHandler: [authenticate, activityAuthorization],\r\n        schema: {\r\n            description: 'Delete activity',\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['activity'],\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            response: {\r\n                200: { properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        try {\r\n            await prisma.activity.delete({\r\n                where: {\r\n                    id,\r\n                    user_id: request.user?.id\r\n                }\r\n            })\r\n            return { success: true }\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    });\r\n\r\n    fastify.get('/me/all', {\r\n        preHandler: [authenticate],\r\n        schema: {\r\n            description: 'Fetch me activities',\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['activity'],\r\n            response: {\r\n                200: SCHEMA_ACTIVITIES_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const activities = await prisma.activity.findMany({\r\n                where: {\r\n                    user_id: request.user?.id\r\n                }\r\n            })\r\n            return activities\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    });\r\n\r\n    fastify.get('/:id', {\r\n        preHandler: [authenticate, activityAuthorization],\r\n        schema: {\r\n            description: 'Fetch activity',\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['activity'],\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            response: {\r\n                200: SCHEMA_ACTIVITY_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { id } = request.params as { id: string }\r\n        try {\r\n            const activity = await prisma.activity.findFirst({\r\n                where: {\r\n                    id\r\n                },\r\n                include: {\r\n                    user: {\r\n                        select: {\r\n                            display_name: true,\r\n                            avatar_file_key: true\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            if (!activity) {\r\n                return reply.status(404).send('Activity not found')\r\n            }\r\n            return activity\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    });\r\n    fastify.get('/fetch/source_ids', {\r\n        preHandler: [authenticate],\r\n        schema: {\r\n            description: 'Fetch activities by source id',\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['activity'],\r\n            response: {\r\n                200: SCHEMA_ACTIVITIES_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const { source_ids } = request.query as { source_ids: string }\r\n        try {\r\n            let ids: string[] = []\r\n            if (source_ids) {\r\n                ids = JSON.parse(source_ids)\r\n            }\r\n            const activities = await prisma.activity.findMany({\r\n                where: {\r\n                    user_id: request.user?.id,\r\n                    source_id: {\r\n                        in: ids.map((item) => item.toString())\r\n                    }\r\n                },\r\n            })\r\n            return activities || []\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    });\r\n}\r\n\r\nexport default activityRoutes"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.schema.ts": {
      "lineLengths": [
        13,
        62,
        75,
        53,
        34,
        19,
        17,
        31,
        33,
        40,
        47,
        37,
        35,
        38,
        47,
        51,
        5,
        2,
        36,
        18,
        17,
        31,
        33,
        40,
        37,
        35,
        38,
        47,
        51,
        5,
        2,
        2876
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.schema.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.schema.ts"
        ],
        "names": [],
        "mappings": ";;;AAAA,qDAAwD;AAE3C,QAAA,sBAAsB,GAAG;IAClC,IAAI,EAAE,QAAQ;IACd,UAAU,EAAE;QACR,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACxB,WAAW,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC/B,IAAI,EAAE,gCAAkB;QACxB,QAAQ,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC5B,MAAM,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC1B,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC7B,kBAAkB,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtC,uBAAuB,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KAC9C;CACJ,CAAA;AAEY,QAAA,wBAAwB,GAAG;IACpC,IAAI,EAAE,OAAO;IACb,UAAU,EAAE;QACR,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtB,IAAI,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACxB,WAAW,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC/B,QAAQ,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC5B,MAAM,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC1B,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QAC7B,kBAAkB,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtC,uBAAuB,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;KAC9C;CACJ,CAAA",
        "sourcesContent": [
          "import { SCHEMA_USER_RETURN } from \"../user/user.schema\"\r\n\r\nexport const SCHEMA_ACTIVITY_RETURN = {\r\n    type: 'object',\r\n    properties: {\r\n        id: { type: 'string' },\r\n        name: { type: 'string' },\r\n        description: { type: 'string' },\r\n        user: SCHEMA_USER_RETURN,\r\n        polyline: { type: 'string' },\r\n        source: { type: 'string' },\r\n        source_id: { type: 'string' },\r\n        distance_in_meters: { type: 'number' },\r\n        elapsed_time_in_seconds: { type: 'number' }\r\n    }\r\n}\r\n\r\nexport const SCHEMA_ACTIVITIES_RETURN = {\r\n    type: 'array',\r\n    properties: {\r\n        id: { type: 'string' },\r\n        name: { type: 'string' },\r\n        description: { type: 'string' },\r\n        polyline: { type: 'string' },\r\n        source: { type: 'string' },\r\n        source_id: { type: 'string' },\r\n        distance_in_meters: { type: 'number' },\r\n        elapsed_time_in_seconds: { type: 'number' }\r\n    }\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_activity.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        39,
        52,
        30,
        57,
        11,
        53,
        31,
        5,
        36,
        16,
        14,
        9,
        27,
        15,
        154,
        105,
        9,
        15,
        7,
        2,
        54,
        2164
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_activity.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/middleware/authorize_activity.ts"
        ],
        "names": [],
        "mappings": ";;;;;;AACA,oDAAuB;AACvB,8BAA+B;AACxB,MAAM,qBAAqB,GAAG,CAAC,OAAuB,EAAE,KAAmB,EAAE,IAA2B,EAAE,EAAE;IAC/G,IAAI,EAAE,CAAA;IACN,IAAI,gBAAC,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,EAAE,CAAC;QAC9B,EAAE,GAAG,OAAO,CAAC,MAAM,CAAC,EAAE,CAAA;IAC1B,CAAC;IACD,WAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QACtB,KAAK,EAAE;YACH,EAAE;SACL;KACJ,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,EAAE;;QACjB,IAAI,CAAA,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,OAAO,OAAK,MAAA,OAAO,CAAC,IAAI,0CAAE,EAAE,CAAA,EAAE,CAAC;YACzC,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,gDAAgD,EAAE,CAAC,CAAA;QAChG,CAAC;QACD,IAAI,EAAE,CAAA;IACV,CAAC,CAAC,CAAA;AACN,CAAC,CAAA;AAfY,QAAA,qBAAqB,yBAejC",
        "sourcesContent": [
          "import { FastifyReply, FastifyRequest } from \"fastify\";\r\nimport _ from \"lodash\";\r\nimport { prisma } from \"../db\";\r\nexport const activityAuthorization = (request: FastifyRequest, reply: FastifyReply, done: (err?: Error) => void) => {\r\n    let id\r\n    if (_.has(request.params, 'id')) {\r\n        id = request.params.id\r\n    }\r\n    prisma.activity.findFirst({\r\n        where: {\r\n            id\r\n        }\r\n    }).then((activity) => {\r\n        if (activity?.user_id !== request.user?.id) {\r\n            return reply.status(401).send({ message: 'You are not authorized to access this resource' })\r\n        }\r\n        done()\r\n    })\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.controller.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        62,
        33,
        52,
        69,
        52,
        65,
        5,
        55,
        63,
        5,
        1,
        75,
        74,
        108,
        79,
        17,
        72,
        28,
        47,
        39,
        21,
        19,
        29,
        59,
        31,
        55,
        53,
        51,
        44,
        25,
        23,
        17,
        76,
        59,
        32,
        49,
        48,
        54,
        29,
        26,
        31,
        54,
        25,
        23,
        17,
        13,
        23,
        35,
        13,
        9,
        5,
        1,
        67,
        31,
        74,
        18,
        54,
        68,
        64,
        42,
        40,
        89,
        13,
        77,
        9,
        5,
        26,
        1,
        7452
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.controller.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/activity/activity.controller.ts"
        ],
        "names": [],
        "mappings": "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",
        "sourcesContent": [
          "import { Activity, Challenge, Matchup } from \"@prisma/client\"\r\nimport { prisma } from \"../../db\"\r\nimport _ from \"lodash\"\r\n\r\nexport async function processActivityForMatchup(userId: string, activity: Activity, matchup: Matchup & { challenge: Challenge }) {\r\n    if (matchup.challenge.name === 'fastest_mile') {\r\n        processFastestSegment(userId, activity, matchup, 1609.4)\r\n    } else if (matchup.challenge.name === 'fastest_5k') {\r\n        processFastestSegment(userId, activity, matchup, 5000)\r\n    }\r\n}\r\n\r\nasync function processFastestSegment(userId: string, activity: Activity, matchup: Matchup & { challenge: Challenge }, distance: number) {\r\n    if (activity.distance_series.length === activity.time_series.length) {\r\n        const fastestSegment = findFastestSegment(activity.distance_series, activity.time_series, distance)\r\n        if (!_.isEmpty(fastestSegment) && fastestSegment.time) {\r\n            try {\r\n                const entry: any = await prisma.matchupEntry.findFirst({\r\n                    where: {\r\n                        matchup_id: matchup.id,\r\n                        user_id: userId\r\n                    }\r\n                })\r\n                if (!entry) {\r\n                    await prisma.matchupEntry.create({\r\n                        data: {\r\n                            value: fastestSegment.time,\r\n                            activity_id: activity.id,\r\n                            matchup_id: matchup.id,\r\n                            user_id: userId,\r\n                        }\r\n                    })\r\n                } else if (entry.value && fastestSegment.time < entry.value) {\r\n                    await prisma.matchupEntry.update({\r\n                        where: {\r\n                            user_id_matchup_id: {\r\n                                user_id: userId,\r\n                                matchup_id: matchup.id\r\n                            }\r\n                        },\r\n                        data: {\r\n                            value: fastestSegment.time\r\n                        }\r\n                    })\r\n                }\r\n            } catch (e) {\r\n                throw new Error(e as string)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction findFastestSegment(distances: number[], timestamps: number[], goal_distance: number) {\r\n    let fastestTime = Infinity;\r\n    let fastestSegment = { startIndex: null, endIndex: null, time: null } as any;\r\n\r\n    let start = 0;\r\n\r\n    for (let end = 0; end < distances.length; end++) {\r\n        while (distances[end] - distances[start] >= goal_distance) {\r\n            let timeTaken = timestamps[end] - timestamps[start];\r\n\r\n            if (timeTaken < fastestTime) {\r\n                fastestTime = timeTaken;\r\n                fastestSegment = { startIndex: start, endIndex: end, time: fastestTime };\r\n            }\r\n            start++;  // Move start forward to check the next possible segment\r\n        }\r\n    }\r\n\r\n    return fastestSegment;\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.routes.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        68,
        53,
        58,
        52,
        33,
        42,
        24,
        62,
        53,
        43,
        30,
        23,
        212,
        13,
        9,
        34,
        19,
        13,
        65,
        24,
        37,
        25,
        25,
        40,
        42,
        43,
        111,
        37,
        33,
        29,
        26,
        25,
        40,
        42,
        43,
        111,
        37,
        33,
        29,
        25,
        21,
        17,
        15,
        27,
        80,
        13,
        76,
        24,
        34,
        18,
        25,
        29,
        36,
        34,
        37,
        32,
        33,
        46,
        39,
        40,
        39,
        25,
        22,
        32,
        33,
        37,
        39,
        43,
        38,
        41,
        43,
        49,
        53,
        63,
        66,
        62,
        56,
        74,
        50,
        57,
        63,
        49,
        45,
        41,
        37,
        33,
        29,
        25,
        22,
        32,
        33,
        37,
        39,
        43,
        38,
        41,
        43,
        49,
        63,
        53,
        66,
        62,
        56,
        74,
        50,
        57,
        63,
        49,
        45,
        41,
        37,
        33,
        29,
        25,
        22,
        17,
        15,
        38,
        80,
        13,
        179,
        179,
        298,
        298,
        111,
        9,
        19,
        58,
        9,
        7,
        45,
        62,
        58,
        43,
        21,
        31,
        29,
        48,
        17,
        14,
        30,
        23,
        213,
        13,
        9,
        34,
        13,
        48,
        65,
        26,
        35,
        18,
        24,
        36,
        25,
        25,
        40,
        44,
        29,
        26,
        25,
        40,
        44,
        29,
        25,
        21,
        18,
        25,
        29,
        36,
        34,
        32,
        33,
        38,
        25,
        22,
        32,
        33,
        38,
        25,
        21,
        17,
        15,
        28,
        9,
        19,
        58,
        9,
        7,
        29,
        62,
        44,
        43,
        19,
        31,
        29,
        48,
        52,
        48,
        48,
        17,
        14,
        30,
        23,
        85,
        13,
        9,
        34,
        15,
        13,
        76,
        40,
        63,
        24,
        92,
        17,
        15,
        27,
        99,
        13,
        26,
        70,
        28,
        36,
        41,
        21,
        19,
        13,
        25,
        136,
        40,
        49,
        17,
        13,
        36,
        128,
        13,
        18,
        39,
        46,
        61,
        48,
        48,
        31,
        54,
        53,
        62,
        48,
        25,
        23,
        46,
        31,
        44,
        26,
        32,
        42,
        25,
        23,
        46,
        31,
        44,
        26,
        32,
        51,
        25,
        22,
        19,
        13,
        37,
        9,
        19,
        58,
        9,
        7,
        33,
        62,
        50,
        43,
        21,
        31,
        29,
        42,
        17,
        14,
        30,
        23,
        212,
        13,
        9,
        34,
        13,
        42,
        65,
        26,
        35,
        18,
        24,
        36,
        22,
        18,
        25,
        29,
        36,
        34,
        37,
        32,
        33,
        46,
        39,
        40,
        39,
        25,
        22,
        32,
        33,
        37,
        39,
        43,
        38,
        41,
        43,
        49,
        53,
        63,
        66,
        62,
        56,
        66,
        50,
        57,
        63,
        49,
        45,
        41,
        37,
        33,
        29,
        25,
        22,
        32,
        33,
        37,
        39,
        43,
        38,
        41,
        43,
        49,
        63,
        53,
        66,
        62,
        56,
        66,
        50,
        57,
        63,
        49,
        45,
        41,
        37,
        33,
        29,
        25,
        22,
        17,
        15,
        27,
        80,
        13,
        146,
        146,
        254,
        254,
        100,
        9,
        19,
        58,
        9,
        7,
        2,
        32,
        35572
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/matchup/matchup.routes.ts"
        ],
        "names": [],
        "mappings": "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",
        "sourcesContent": [
          "import { FastifyPluginAsync } from \"fastify\"\r\nimport { authenticate } from \"../../middleware/authentication\"\r\nimport { SCHEMA_MATCHUP_RETURN, SCHEMA_MATCHUPS_RETURN } from \"./matchup.schema\"\r\nimport { getTimesAndSum } from \"../../cron/post_matchup\"\r\nimport _ from \"lodash\"\r\nimport { prisma } from \"../../db\"\r\nimport { Squad } from \"@prisma/client\" \r\nconst matchupRoutes: FastifyPluginAsync = async (fastify) => {\r\n    fastify.get('/me', {\r\n        preHandler: [authenticate], schema: {\r\n            description: 'Fetch your active matchup',\r\n            security: [{ bearerAuth: [] }],\r\n            tags: ['matchup'],\r\n            response: {\r\n                200: { ...SCHEMA_MATCHUP_RETURN, properties: { ...SCHEMA_MATCHUP_RETURN.properties, _squad_one_score: { type: 'number' }, _squad_two_score: { type: 'number' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const matchup = await prisma.matchup.findFirst({\r\n                where: {\r\n                    completed: false,\r\n                    OR: [\r\n                        {\r\n                            squad_one: {\r\n                                members: {\r\n                                    some: {\r\n                                        user_id: request.user?.id\r\n                                    }\r\n                                }\r\n                            }\r\n                        },\r\n                        {\r\n                            squad_two: {\r\n                                members: {\r\n                                    some: {\r\n                                        user_id: request.user?.id\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            })\r\n            if (!matchup) {\r\n                return reply.status(404).send({ message: 'Matchup not found' })\r\n            }\r\n            const matchupWithEntries = await prisma.matchup.findFirst({\r\n                where: {\r\n                    id: matchup.id\r\n                },\r\n                select: {\r\n                    id: true,\r\n                    starts_at: true,\r\n                    ends_at: true,\r\n                    created_at: true,\r\n                    challenge: {\r\n                        select: {\r\n                            description: true,\r\n                            type: true,\r\n                            label: true,\r\n                            name: true,\r\n                        }\r\n                    },\r\n                    squad_one: {\r\n                        select: {\r\n                            id: true,\r\n                            name: true,\r\n                            owner_id: true,\r\n                            members: {\r\n                                select: {\r\n                                    user: {\r\n                                        select: {\r\n                                            id: true,\r\n                                            display_name: true,\r\n                                            avatar_file_key: true,\r\n                                            matchup_entries: {\r\n                                                where: {\r\n                                                    matchup_id: matchup.id\r\n                                                },\r\n                                                select: {\r\n                                                    value: true\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    squad_two: {\r\n                        select: {\r\n                            id: true,\r\n                            name: true,\r\n                            owner_id: true,\r\n                            members: {\r\n                                select: {\r\n                                    user: {\r\n                                        select: {\r\n                                            display_name: true,\r\n                                            id: true,\r\n                                            avatar_file_key: true,\r\n                                            matchup_entries: {\r\n                                                where: {\r\n                                                    matchup_id: matchup.id\r\n                                                },\r\n                                                select: {\r\n                                                    value: true\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                }\r\n            })\r\n            if (!matchupWithEntries) {\r\n                return reply.status(404).send({ message: 'Matchup not found' })\r\n            }\r\n            const squadOneScore = getTimesAndSum(matchupWithEntries?.squad_one.members as any)\r\n            const squadTwoScore = getTimesAndSum(matchupWithEntries?.squad_two.members as any)\r\n            matchupWithEntries.squad_one.members = _.sortBy(matchupWithEntries?.squad_one.members, (item) => item.user.matchup_entries[0]?.value)\r\n            matchupWithEntries.squad_two.members = _.sortBy(matchupWithEntries?.squad_two.members, (item) => item.user.matchup_entries[0]?.value)\r\n            return { ...matchupWithEntries, _squad_one_score: squadOneScore, _squad_two_score: squadTwoScore }\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    })\r\n\r\n    fastify.get('/squad/:squad_id/results', {\r\n        preHandler: [authenticate], schema: {\r\n            description: 'Fetch a squads matchup results',\r\n            security: [{ bearerAuth: [] }],\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    squad_id: { type: 'string' }\r\n                }\r\n            },\r\n            tags: ['matchup'],\r\n            response: {\r\n                200: { ...SCHEMA_MATCHUPS_RETURN, properties: { ...SCHEMA_MATCHUP_RETURN.properties, _squad_one_score: { type: 'number' }, _squad_two_score: { type: 'number' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const { squad_id } = request.params as { squad_id: string }\r\n            const matchups = await prisma.matchup.findMany({\r\n                orderBy: {\r\n                    ends_at: 'desc'\r\n                },\r\n                where: {\r\n                    completed: true,\r\n                    OR: [\r\n                        {\r\n                            squad_one: {\r\n                                id: squad_id\r\n                            }\r\n                        },\r\n                        {\r\n                            squad_two: {\r\n                                id: squad_id\r\n                            }\r\n                        }\r\n                    ]\r\n                },\r\n                select: {\r\n                    id: true,\r\n                    challenge: true,\r\n                    ends_at: true,\r\n                    squad_one: {\r\n                        select: {\r\n                            name: true\r\n                        }\r\n                    },\r\n                    squad_two: {\r\n                        select: {\r\n                            name: true\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            return matchups\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    })\r\n\r\n    fastify.post('/create', {\r\n        preHandler: [authenticate], schema: {\r\n            description: 'Create a matchup',\r\n            security: [{ bearerAuth: [] }],\r\n            body: {\r\n                type: 'object',\r\n                properties: {\r\n                    squadId: { type: 'string' },\r\n                    challengeId: { type: 'string' },\r\n                    random: { type: 'boolean' },\r\n                    duration: { type: 'number' }\r\n                }\r\n            },\r\n            tags: ['matchup'],\r\n            response: {\r\n                201: { type: 'object', properties: { success: { type: 'boolean' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const { squadId, challengeId, random, duration } = request.body as { squadId?: string, challengeId: string, random?: boolean, duration: number }\r\n            let squadToChallenge: Squad | null = null\r\n            const mySquad = await prisma.squad.findFirst({\r\n                where: {\r\n                    owner_id: request.user?.id\r\n                }\r\n            })\r\n            if (!mySquad) {\r\n                return reply.status(400).send('You must own a squad in order to create a matchup')\r\n            }\r\n            if (squadId) {\r\n                squadToChallenge = await prisma.squad.findFirst({\r\n                    where: {\r\n                        id: squadId,\r\n                        is_engaged: false\r\n                    }\r\n                })\r\n            }\r\n            if (random) {\r\n                const squads: Squad[] = await prisma.$queryRaw`SELECT * FROM \"squads\" WHERE id != ${mySquad.id} ORDER BY RANDOM() LIMIT 1`;\r\n                if (squads.length > 0) {\r\n                    squadToChallenge = squads[0]\r\n                }\r\n            }\r\n\r\n            if (!squadToChallenge) {\r\n                return reply.status(404).send('We are unable to create a matchup for you at this time. Please try again later')\r\n            } else {\r\n                const now = new Date();\r\n                const endsAtDate = new Date();\r\n                endsAtDate.setDate(now.getDate() + duration)\r\n                await prisma.$transaction([\r\n                    prisma.matchup.create({\r\n                        data: {\r\n                            challenge_id: challengeId,\r\n                            squad_one_id: mySquad.id,\r\n                            squad_two_id: squadToChallenge.id,\r\n                            ends_at: endsAtDate,\r\n                        }\r\n                    }),\r\n                    prisma.squad.update({\r\n                        data: {\r\n                            is_engaged: true\r\n                        },\r\n                        where: {\r\n                            id: mySquad.id\r\n                        }\r\n                    }),\r\n                    prisma.squad.update({\r\n                        data: {\r\n                            is_engaged: true\r\n                        },\r\n                        where: {\r\n                            id: squadToChallenge.id\r\n                        }\r\n                    })\r\n                ])\r\n            }\r\n            return { success: true }\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    })\r\n\r\n    fastify.get('/:id/results', {\r\n        preHandler: [authenticate], schema: {\r\n            description: 'Fetch a matchup result',\r\n            security: [{ bearerAuth: [] }],\r\n            params: {\r\n                type: 'object',\r\n                properties: {\r\n                    id: { type: 'string' }\r\n                }\r\n            },\r\n            tags: ['matchup'],\r\n            response: {\r\n                200: { ...SCHEMA_MATCHUP_RETURN, properties: { ...SCHEMA_MATCHUP_RETURN.properties, _squad_one_score: { type: 'number' }, _squad_two_score: { type: 'number' } } }\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        try {\r\n            const { id } = request.params as { id: string }\r\n            const matchup = await prisma.matchup.findFirst({\r\n                orderBy: {\r\n                    ends_at: 'desc'\r\n                },\r\n                where: {\r\n                    completed: true,\r\n                    id\r\n                },\r\n                select: {\r\n                    id: true,\r\n                    starts_at: true,\r\n                    ends_at: true,\r\n                    created_at: true,\r\n                    challenge: {\r\n                        select: {\r\n                            description: true,\r\n                            type: true,\r\n                            label: true,\r\n                            name: true,\r\n                        }\r\n                    },\r\n                    squad_one: {\r\n                        select: {\r\n                            id: true,\r\n                            name: true,\r\n                            owner_id: true,\r\n                            members: {\r\n                                select: {\r\n                                    user: {\r\n                                        select: {\r\n                                            id: true,\r\n                                            display_name: true,\r\n                                            avatar_file_key: true,\r\n                                            matchup_entries: {\r\n                                                where: {\r\n                                                    matchup_id: id\r\n                                                },\r\n                                                select: {\r\n                                                    value: true\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    squad_two: {\r\n                        select: {\r\n                            id: true,\r\n                            name: true,\r\n                            owner_id: true,\r\n                            members: {\r\n                                select: {\r\n                                    user: {\r\n                                        select: {\r\n                                            display_name: true,\r\n                                            id: true,\r\n                                            avatar_file_key: true,\r\n                                            matchup_entries: {\r\n                                                where: {\r\n                                                    matchup_id: id\r\n                                                },\r\n                                                select: {\r\n                                                    value: true\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                }\r\n            })\r\n            if (!matchup) {\r\n                return reply.status(404).send({ message: 'Matchup not found' })\r\n            }\r\n            const squadOneScore = getTimesAndSum(matchup?.squad_one.members as any)\r\n            const squadTwoScore = getTimesAndSum(matchup?.squad_two.members as any)\r\n            matchup.squad_one.members = _.sortBy(matchup?.squad_one.members, (item) => item.user.matchup_entries[0]?.value)\r\n            matchup.squad_two.members = _.sortBy(matchup?.squad_two.members, (item) => item.user.matchup_entries[0]?.value)\r\n            return { ...matchup, _squad_one_score: squadOneScore, _squad_two_score: squadTwoScore }\r\n        } catch (e) {\r\n            return reply.status(500).send({ message: e as string })\r\n        }\r\n    })\r\n}\r\n\r\nexport default matchupRoutes"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/cron/post_matchup.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        33,
        40,
        31,
        52,
        30,
        28,
        20,
        19,
        20,
        5,
        19,
        20,
        5,
        19,
        20,
        5,
        17,
        1,
        58,
        63,
        63,
        50,
        66,
        5,
        157,
        1,
        34,
        303,
        139,
        79,
        1,
        76,
        35,
        63,
        5,
        28,
        1,
        62,
        47,
        40,
        46,
        35,
        25,
        43,
        19,
        3,
        42,
        9,
        70,
        20,
        33,
        26,
        49,
        17,
        14,
        22,
        28,
        29,
        34,
        21,
        18,
        28,
        29,
        33,
        35,
        42,
        34,
        37,
        39,
        45,
        49,
        59,
        58,
        53,
        59,
        45,
        41,
        37,
        33,
        29,
        25,
        21,
        18,
        28,
        29,
        33,
        35,
        42,
        34,
        37,
        39,
        45,
        49,
        59,
        58,
        53,
        59,
        45,
        41,
        37,
        33,
        29,
        25,
        21,
        17,
        13,
        11,
        50,
        138,
        25,
        32,
        33,
        13,
        24,
        34,
        13,
        35,
        56,
        13,
        44,
        42,
        28,
        85,
        22,
        27,
        42,
        90,
        92,
        85,
        21,
        19,
        42,
        28,
        82,
        22,
        27,
        42,
        90,
        21,
        19,
        44,
        28,
        38,
        22,
        27,
        39,
        21,
        18,
        29,
        31,
        15,
        9,
        5,
        15,
        25,
        5,
        1,
        14548
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/cron/post_matchup.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/cron/post_matchup.ts"
        ],
        "names": [],
        "mappings": "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",
        "sourcesContent": [
          "import { CronJob } from \"cron\"\r\nimport _ from \"lodash\"\r\nimport { Level, MatchupEntry, Squad, SquadMember, User } from \"@prisma/client\"\r\nimport { prisma } from \"../db\"\r\n\r\ntype SquadWithMatchupEntries = Squad & { members: (SquadMember & { user: User & { matchup_entries: MatchupEntry[] } })[] }\r\n\r\nfunction getSquadLevel(xp: number): Level {\r\n    let level: Level = 'D'\r\n    if (xp > 150) {\r\n        level = 'C'\r\n    }\r\n    if (xp > 300) {\r\n       level = 'B'\r\n    }\r\n    if (xp > 500) {\r\n        level = 'A'\r\n    }\r\n    return level\r\n}\r\n\r\nfunction calculateWinningSquadByTime(squadOne: SquadWithMatchupEntries, squadTwo: SquadWithMatchupEntries): { winner?: Squad, loser?: Squad, isTie: boolean } {\r\n    const squadOneTotalTime = getTimesAndSum(squadOne.members)\r\n    const squadTwoTotalTime = getTimesAndSum(squadOne.members)\r\n    if (squadOneTotalTime === squadTwoTotalTime) {\r\n        return { isTie: true, winner: squadOne, loser: squadTwo }\r\n    }\r\n    return squadOneTotalTime < squadTwoTotalTime ? { winner: squadOne, loser: squadTwo, isTie: false } : { winner: squadTwo, loser: squadOne, isTie: false }\r\n}\r\n\r\nexport function getTimesAndSum(members: (SquadMember & { user: User & { matchup_entries: MatchupEntry[] } })[]) {\r\n    const squadSortedMembersByTime = _.sortBy(members, (item) => item.user.matchup_entries[0]?.value).filter((item) => item.user.matchup_entries[0]?.value)\r\n    const squadTotalTime = _.reduce(squadSortedMembersByTime, (a, b) => { return a + b.user.matchup_entries[0].value }, 0)\r\n    return Math.round(squadTotalTime / (squadSortedMembersByTime.length || 1))\r\n}\r\n\r\nfunction determineWinningAndLosingSquad(squadOne: any, squadTwo: any, challengeType: string): { winner?: Squad, loser?: Squad, isTie: boolean } {\r\n    if (challengeType === 'time') {\r\n        return calculateWinningSquadByTime(squadOne, squadTwo)\r\n    }\r\n    return { isTie: false }\r\n}\r\n\r\n// Cron for building reports from matchups that have concluded\r\nexport const postMatchupCron = CronJob.from({\r\n    cronTime: '*/3 * * * *', // cronTime\r\n    onTick: buildPostMatchupReports, // onTick\r\n    onComplete: null, // onComplete\r\n    start: true, // start\r\n    timeZone: 'America/Denver', // timeZone\r\n    runOnInit: true\r\n});\r\n\r\nasync function buildPostMatchupReports() {\r\n    try {\r\n        const concludedMatchups = await prisma.matchup.findMany({\r\n            where: {\r\n                completed: false,\r\n                ends_at: {\r\n                    lte: new Date().toISOString()\r\n                }\r\n            },\r\n            include: {\r\n                challenge: {\r\n                    select: {\r\n                        type: true\r\n                    }\r\n                },\r\n                squad_one: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        description: true,\r\n                        members: {\r\n                            select: {\r\n                                user: {\r\n                                    select: {\r\n                                        id: true,\r\n                                        display_name: true,\r\n                                        matchup_entries: {\r\n                                            select: {\r\n                                                value: true\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                squad_two: {\r\n                    select: {\r\n                        id: true,\r\n                        name: true,\r\n                        description: true,\r\n                        members: {\r\n                            select: {\r\n                                user: {\r\n                                    select: {\r\n                                        id: true,\r\n                                        display_name: true,\r\n                                        matchup_entries: {\r\n                                            select: {\r\n                                                value: true\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        for (const matchup of concludedMatchups) {\r\n            const { winner, loser, isTie } = determineWinningAndLosingSquad(matchup.squad_one, matchup.squad_two, matchup.challenge.type)\r\n            if (winner) {\r\n                winner.xp += 50\r\n                winner.wins += 1\r\n            }\r\n            if (loser) {\r\n                loser.losses += 1\r\n            }\r\n            if (!isTie && winner) {\r\n                winner.level = getSquadLevel(winner.xp)\r\n            }\r\n            await prisma.$transaction([\r\n                prisma.squad.update({\r\n                    where: {\r\n                        id: winner?.id\r\n                    },\r\n                    data: {\r\n                        is_engaged: false,\r\n                        wins: winner?.wins,\r\n                        level: winner?.level,\r\n                        xp: winner?.xp\r\n                    }\r\n                }),\r\n                prisma.squad.update({\r\n                    where: {\r\n                        id: loser?.id\r\n                    },\r\n                    data: {\r\n                        is_engaged: false,\r\n                        losses: loser?.losses\r\n                    }\r\n                }),\r\n                prisma.matchup.update({\r\n                    where: {\r\n                        id: matchup.id\r\n                    },\r\n                    data: {\r\n                        completed: true\r\n                    }\r\n                })\r\n            ]).catch((e) => {\r\n                console.log(e)\r\n            })\r\n        }\r\n    } catch (e) {\r\n        console.error(e)\r\n    }\r\n}"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/strava/strava.routes.ts": {
      "lineLengths": [
        13,
        72,
        62,
        2,
        62,
        52,
        22,
        41,
        49,
        36,
        59,
        63,
        9,
        7,
        2,
        31,
        1492
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/strava/strava.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/strava/strava.routes.ts"
        ],
        "names": [],
        "mappings": ";;;;;AACA,oDAAsB;AAEtB,sBAAsB;AAEtB,MAAM,YAAY,GAAuB,KAAK,EAAE,OAAO,EAAE,EAAE;IACvD,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE;QACvC,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAA;QAC3B,IAAI,gBAAC,CAAC,GAAG,CAAC,KAAK,EAAE,eAAe,CAAC,EAAE,CAAC;YAChC,OAAO,EAAE,eAAe,EAAE,KAAK,CAAC,eAAe,CAAC,EAAE,CAAA;QACtD,CAAC;IACL,CAAC,CAAC,CAAA;AACN,CAAC,CAAA;AAED,kBAAe,YAAY,CAAA",
        "sourcesContent": [
          "import { FastifyPluginAsync } from \"fastify\"\r\nimport _ from \"lodash\"\r\n\r\n// console.log(prisma)\r\n\r\nconst stravaRoutes: FastifyPluginAsync = async (fastify) => {\r\n    fastify.get('/webhook', (request, reply) => {\r\n        const query = request.query\r\n        if (_.has(query, 'hub.challenge')) {\r\n            return { \"hub.challenge\": query[\"hub.challenge\"] }\r\n        }\r\n    })\r\n}\r\n\r\nexport default stravaRoutes"
        ],
        "sourceRoot": ""
      }
    },
    "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.routes.ts": {
      "lineLengths": [
        13,
        62,
        57,
        68,
        33,
        44,
        22,
        50,
        17,
        32,
        23,
        64,
        13,
        9,
        34,
        66,
        26,
        7,
        2,
        34,
        1936
      ],
      "data": {
        "version": 3,
        "file": "C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.routes.ts",
        "sources": [
          "file:///C:/Users/brady/Projects/api_fastify_primsa_template/src/routes/challenge/challenge.routes.ts"
        ],
        "names": [],
        "mappings": ";;AACA,yDAA8D;AAC9D,oEAA+D;AAC/D,iCAAkC;AAElC,MAAM,eAAe,GAAuB,KAAK,EAAE,OAAO,EAAE,EAAE;IAC1D,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE;QACb,UAAU,EAAE,6BAAY;QACxB,MAAM,EAAE;YACJ,IAAI,EAAE,CAAC,WAAW,CAAC;YACnB,QAAQ,EAAE;gBACN,GAAG,EAAE,2CAAwB;aAChC;SACJ;KACJ,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;QACxB,MAAM,UAAU,GAAG,MAAM,WAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAA;QACpD,OAAO,UAAU,CAAA;IACrB,CAAC,CAAC,CAAA;AAEN,CAAC,CAAA;AAED,kBAAe,eAAe,CAAA",
        "sourcesContent": [
          "import { FastifyPluginAsync } from \"fastify\";\r\nimport { SCHEMA_CHALLENGES_RETURN } from \"./challenge.schema\";\r\nimport { authenticate } from \"../../middleware/authentication\";\r\nimport { prisma } from \"../../db\";\r\n\r\nconst challengeRoutes: FastifyPluginAsync = async (fastify) => {\r\n    fastify.get('/', {\r\n        preHandler: authenticate,\r\n        schema: {\r\n            tags: ['challenge'],\r\n            response: {\r\n                200: SCHEMA_CHALLENGES_RETURN\r\n            }\r\n        }\r\n    }, async (request, reply) => {\r\n        const challenges = await prisma.challenge.findMany()\r\n        return challenges\r\n    })\r\n\r\n}\r\n\r\nexport default challengeRoutes"
        ],
        "sourceRoot": ""
      }
    }
  }
}
